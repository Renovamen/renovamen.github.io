<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.png" type="image/png"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><meta name="msapplication-TileColor" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("vueuse-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><script type="module" async="" crossorigin="" src="/assets/app-99b2740d.js"></script><style>.prompt[data-v-4d808a77]{vertical-align:-.2em;font-size:.85em}.blink[data-v-4d808a77]{animation:blinker-4d808a77 1s none infinite}@keyframes blinker-4d808a77{50%{opacity:0}}*,:after,:before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji"}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}h1,h2,h3{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}code,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}button{font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button{text-transform:none}button{-webkit-appearance:button;background-color:transparent;background-image:none}h1,h2,h3,hr,p,pre{margin:0}ul{list-style:none;margin:0;padding:0}button{cursor:pointer}svg{display:block;vertical-align:middle}*,:after,:before{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-scroll-snap-strictness:proximity;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow:0 0 rgba(0,0,0,0);--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,.5)}@font-face{font-family:DM Sans;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/dmsans/v11/rP2Hp2ywxg089UriCZ2IHSeH.woff2) format("woff2");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:DM Sans;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/dmsans/v11/rP2Hp2ywxg089UriCZOIHQ.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:DM Sans;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/dmsans/v11/rP2Cp2ywxg089UriASitCBamC2QX.woff2) format("woff2");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:DM Sans;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/dmsans/v11/rP2Cp2ywxg089UriASitCBimCw.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}[i-fa6-solid\:angle-right=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 320 512' display='inline-block' vertical-align='sub' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256L73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;display:inline-block;vertical-align:sub;width:1.2em;height:1.2em}[i-ic\:round-update=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' display='inline-block' vertical-align='sub' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M11 8.75v3.68c0 .35.19.68.49.86l3.12 1.85c.36.21.82.09 1.03-.26c.21-.36.1-.82-.26-1.03l-2.87-1.71v-3.4c-.01-.4-.35-.74-.76-.74s-.75.34-.75.75zm10 .75V4.21c0-.45-.54-.67-.85-.35l-1.78 1.78a9.01 9.01 0 0 0-7.21-2.6c-4.19.38-7.64 3.75-8.1 7.94a9 9 0 0 0 17.87 2.14c.07-.6-.4-1.12-1-1.12c-.5 0-.92.37-.98.86c-.43 3.49-3.44 6.19-7.05 6.14c-3.71-.05-6.84-3.18-6.9-6.9C4.94 8.2 8.11 5 12 5c1.93 0 3.68.79 4.95 2.05l-2.09 2.09c-.32.32-.1.86.35.86h5.29c.28 0 .5-.22.5-.5z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;display:inline-block;vertical-align:sub;width:1.2em;height:1.2em}[i-jam\:rss-feed=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='-4 -4 24 24' display='inline-block' vertical-align='sub' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M1.996 15.97a1.996 1.996 0 1 1 0-3.992a1.996 1.996 0 0 1 0 3.992zM1.12 7.977a.998.998 0 0 1-.247-1.98a8.103 8.103 0 0 1 9.108 8.04v.935a.998.998 0 1 1-1.996 0v-.934a6.108 6.108 0 0 0-6.865-6.06zM0 1.065A.998.998 0 0 1 .93.002C8.717-.517 15.448 5.374 15.967 13.16c.042.626.042 1.254 0 1.88a.998.998 0 1 1-1.992-.133c.036-.538.036-1.077 0-1.614C13.53 6.607 7.75 1.548 1.065 1.994A.998.998 0 0 1 0 1.064z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;display:inline-block;vertical-align:sub;width:1.2em;height:1.2em}[i-majesticons\:pencil-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' display='inline-block' vertical-align='sub' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cg fill='currentColor'%3E%3Cpath d='M15.586 3a2 2 0 0 1 2.828 0L21 5.586a2 2 0 0 1 0 2.828l-12 12A2 2 0 0 1 7.586 21H5a2 2 0 0 1-2-2v-2.586A2 2 0 0 1 3.586 15l12-12zm-.172 3L18 8.586L19.586 7L17 4.414L15.414 6zm1.172 4L14 7.414l-9 9V19h2.586l9-9z'/%3E%3C/g%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;display:inline-block;vertical-align:sub;width:1.2em;height:1.2em}[i-ph\:rocket-launch-duotone=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 256 256' display='inline-block' vertical-align='sub' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M94.1 184.6c-11.4 33.9-56.6 33.9-56.6 33.9s0-45.2 33.9-56.6Zm90.5-67.9v64.6a8 8 0 0 1-2.4 5.6l-32.3 32.4a8 8 0 0 1-13.5-4.1l-8.4-41.9Zm-45.3-45.3H74.7a8 8 0 0 0-5.6 2.4l-32.4 32.3a8 8 0 0 0 4.1 13.5l41.9 8.4Z' opacity='.2'/%3E%3Cpath fill='currentColor' d='M96.6 177a7.9 7.9 0 0 0-10.1 5c-6.6 19.7-27.9 25.8-40.2 27.7c1.9-12.3 8-33.6 27.7-40.2a8 8 0 1 0-5.1-15.1c-16.4 5.4-28.4 18.4-34.8 37.5a91.8 91.8 0 0 0-4.6 26.6a8 8 0 0 0 8 8a91.8 91.8 0 0 0 26.6-4.6c19.1-6.4 32.1-18.4 37.5-34.8a7.9 7.9 0 0 0-5-10.1Z'/%3E%3Cpath fill='currentColor' d='M227.6 41.8a15.7 15.7 0 0 0-13.4-13.4c-11.3-1.7-40.6-2.5-69.2 26.1l-9 8.9H74.7a16.2 16.2 0 0 0-11.3 4.7l-32.3 32.4a15.9 15.9 0 0 0-4 15.9a16 16 0 0 0 12.2 11.1l39.5 7.9l41.8 41.8l7.9 39.5a16 16 0 0 0 11.1 12.2a14.7 14.7 0 0 0 4.6.7a15.6 15.6 0 0 0 11.3-4.7l32.4-32.3a16.2 16.2 0 0 0 4.7-11.3V120l8.9-9c28.6-28.6 27.8-57.9 26.1-69.2ZM74.7 79.4H120l-39.9 39.9l-37.7-7.5Zm81.6-13.6c7.8-7.8 28.8-25.6 55.5-21.6c4 26.7-13.8 47.7-21.6 55.5L128 161.9L94.1 128Zm20.3 115.5l-32.4 32.3l-7.5-37.7l39.9-39.9Z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;display:inline-block;vertical-align:sub;width:1.2em;height:1.2em}[i-tabler\:edit=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' display='inline-block' vertical-align='sub' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cg fill='none' stroke='currentColor' stroke-linecap='round' stroke-linejoin='round' stroke-width='2'%3E%3Cpath d='M7 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-1'/%3E%3Cpath d='M20.385 6.585a2.1 2.1 0 0 0-2.97-2.97L9 12v3h3l8.385-8.415zM16 5l3 3'/%3E%3C/g%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;display:inline-block;vertical-align:sub;width:1.2em;height:1.2em}[i-uil\:tag-alt=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' display='inline-block' vertical-align='sub' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M7.5 6A1.5 1.5 0 1 0 9 7.5A1.5 1.5 0 0 0 7.5 6Zm13.62 4.71l-8.41-8.42A1 1 0 0 0 12 2H3a1 1 0 0 0-1 1v9a1 1 0 0 0 .29.71l8.42 8.41a3 3 0 0 0 4.24 0L21.12 15a3 3 0 0 0 0-4.24Zm-1.41 2.82l-6.18 6.17a1 1 0 0 1-1.41 0L4 11.59V4h7.59l8.12 8.12a1 1 0 0 1 .29.71a1 1 0 0 1-.29.7Z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;display:inline-block;vertical-align:sub;width:1.2em;height:1.2em}[i~=carbon-sun]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 32 32' display='inline-block' vertical-align='sub' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6ZM5.394 6.813L6.81 5.399l3.505 3.506L8.9 10.319zM2 15.005h5v2H2zm3.394 10.193L8.9 21.692l1.414 1.414l-3.505 3.506zM15 25.005h2v5h-2zm6.687-1.9l1.414-1.414l3.506 3.506l-1.414 1.414zm3.313-8.1h5v2h-5zm-3.313-6.101l3.506-3.506l1.414 1.414l-3.506 3.506zM15 2.005h2v5h-2z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;display:inline-block;vertical-align:sub;width:1.2em;height:1.2em}.prose :where(h1,h2,h3,h4,h5,h6):not(:where(.not-prose,.not-prose*)){color:var(--un-prose-headings);font-weight:600;line-height:1.25}.prose :where(a):not(:where(.not-prose,.not-prose*)){color:var(--un-prose-links);text-decoration:underline;font-weight:500}.prose :where(p,ul,ol,pre):not(:where(.not-prose,.not-prose*)){margin:1em 0;line-height:1.75}.prose :where(h2):not(:where(.not-prose,.not-prose*)){margin:1.75em 0 .5em;font-size:1.75em}.prose :where(h3):not(:where(.not-prose,.not-prose*)){margin:1.5em 0 .5em;font-size:1.375em}.prose :where(code):not(:where(.not-prose,.not-prose*)){color:var(--un-prose-code);font-size:.875em;font-weight:600;font-family:var(--un-prose-font-mono)}.prose :where(:not(pre)>code):not(:where(.not-prose,.not-prose*)):after,.prose :where(:not(pre)>code):not(:where(.not-prose,.not-prose*)):before{content:"`"}.prose :where(pre):not(:where(.not-prose,.not-prose*)){padding:1.25rem 1.5rem;overflow-x:auto;border-radius:.375rem}.prose :where(pre,code):not(:where(.not-prose,.not-prose*)){white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;hyphens:none;background:0 0}.prose :where(precode):not(:where(.not-prose,.not-prose*)){font-weight:inherit}.prose :where(ol,ul):not(:where(.not-prose,.not-prose*)){padding-left:1.25em}.prose :where(ul):not(:where(.not-prose,.not-prose*)){list-style-type:disc}.prose :where(ul>li):not(:where(.not-prose,.not-prose*))::marker{color:var(--un-prose-lists)}.prose :where(hr):not(:where(.not-prose,.not-prose*)){margin:2em 0;border:1px solid var(--un-prose-hr)}.prose{color:var(--un-prose-body);max-width:65ch}.prose-lg,[prose-lg=""]{max-width:85ch}[nav-item=""]{display:flex;align-items:center;--un-text-opacity:1;color:rgba(31,41,55,var(--un-text-opacity));opacity:.85}[nav-item=""]>:not([hidden])~:not([hidden]){--un-space-x-reverse:0;margin-left:calc(.25rem * calc(1 - var(--un-space-x-reverse)));margin-right:calc(.25rem * var(--un-space-x-reverse))}.border-c{--un-border-opacity:1;border-color:rgba(229,231,235,var(--un-border-opacity))}.bg-c{--un-bg-opacity:1;background-color:rgba(255,255,255,var(--un-bg-opacity))}[nav-item=""]:hover{--un-text-opacity:1;color:rgba(0,0,0,var(--un-text-opacity))}.text-c{--un-text-opacity:1;color:rgba(31,41,55,var(--un-text-opacity))}.text-c-active{--un-text-opacity:1;color:rgba(23,114,208,var(--un-text-opacity))}[text~=c-lighter]{--un-text-opacity:1;color:rgba(31,41,55,var(--un-text-opacity));opacity:.5}[text~=c-light],[un-text~=c-light]{--un-text-opacity:1;color:rgba(31,41,55,var(--un-text-opacity));opacity:.85}@media (min-width:1024px){.prose-lg,[prose-lg=""]{font-size:1.125rem;line-height:1.75rem}}.absolute{position:absolute}.left-0{left:0}.top-0{top:0}.z-40{z-index:40}.grid{display:grid}.m-auto{margin:auto}[mx-auto=""]{margin-left:auto;margin-right:auto}.mb-6{margin-bottom:1.5rem}[mb-8=""]{margin-bottom:2rem}[mr-1=""]{margin-right:.25rem}[mt-16=""]{margin-top:4rem}.mt-2{margin-top:.5rem}[mt-20=""],[m~=t-20]{margin-top:5rem}[mt-6=""]{margin-top:1.5rem}.inline-block{display:inline-block}.h-14{height:3.5rem}[h-4\.5=""]{height:1.125rem}.min-h-full{min-height:100%}[w-4\.5=""]{width:1.125rem}.w-full{width:100%}.flex,[flex=""]{display:flex}.flex-1{flex:1 1 0%}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-between{justify-content:space-between}[space-x-4=""]>:not([hidden])~:not([hidden]){--un-space-x-reverse:0;margin-left:calc(1rem * calc(1 - var(--un-space-x-reverse)));margin-right:calc(1rem * var(--un-space-x-reverse))}.border-t{border-top-width:1px}[p~=x-4]{padding-left:1rem;padding-right:1rem}.pb-3{padding-bottom:.75rem}.pt-3{padding-top:.75rem}[p~=b-6]{padding-bottom:1.5rem}[p~=t-24]{padding-top:6rem}[text~=center]{text-align:center}.text-left{text-align:left}.text-right{text-align:right}[align-text-top=""]{vertical-align:text-top}.font-sans{font-family:Computer Modern Sans,system-ui,-apple-system,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif}.font-ui,[font~=ui]{font-family:DM Sans}.text-\[0\.95em\]{font-size:.95em}.text-4xl{font-size:2.25rem;line-height:2.5rem}[text-sm=""],[text~=sm]{font-size:.875rem;line-height:1.25rem}[text~=lg]{font-size:1.125rem;line-height:1.75rem}.font-bold{font-weight:700}.leading-12{line-height:3rem}.hover\:underline:hover,[hover\:underline=""]:hover{text-decoration-line:underline}.opacity-50{opacity:.5}@media (max-width:767.9px){.lt-md\:hidden{display:none}}@media (min-width:768px){.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}[md\:hidden=""]{display:none}}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:700;src:url(/assets/KaTeX_Main-Bold-0f60d1b8.woff2) format("woff2"),url(/assets/KaTeX_Main-Bold-c76c5d69.woff) format("woff"),url(/assets/KaTeX_Main-Bold-138ac28d.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:700;src:url(/assets/KaTeX_Main-BoldItalic-99cd42a3.woff2) format("woff2"),url(/assets/KaTeX_Main-BoldItalic-a6f7ec0d.woff) format("woff"),url(/assets/KaTeX_Main-BoldItalic-70ee1f64.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:400;src:url(/assets/KaTeX_Main-Italic-97479ca6.woff2) format("woff2"),url(/assets/KaTeX_Main-Italic-f1d6ef86.woff) format("woff"),url(/assets/KaTeX_Main-Italic-0d85ae7c.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:400;src:url(/assets/KaTeX_Main-Regular-c2342cd8.woff2) format("woff2"),url(/assets/KaTeX_Main-Regular-c6368d87.woff) format("woff"),url(/assets/KaTeX_Main-Regular-d0332f52.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:700;src:url(/assets/KaTeX_Math-BoldItalic-dc47344d.woff2) format("woff2"),url(/assets/KaTeX_Math-BoldItalic-850c0af5.woff) format("woff"),url(/assets/KaTeX_Math-BoldItalic-f9377ab0.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:400;src:url(/assets/KaTeX_Math-Italic-7af58c5e.woff2) format("woff2"),url(/assets/KaTeX_Math-Italic-8a8d2445.woff) format("woff"),url(/assets/KaTeX_Math-Italic-08ce98e5.ttf) format("truetype")}.katex{text-rendering:auto;font:1.21em KaTeX_Main,Times New Roman,serif;line-height:1.2;text-indent:0}.katex *{-ms-high-contrast-adjust:none!important;border-color:currentColor}.katex .base{position:relative;white-space:nowrap;width:-webkit-min-content;width:-moz-min-content;width:min-content}.katex .base,.katex .strut{display:inline-block}.katex .mathnormal{font-family:KaTeX_Math;font-style:italic}.katex .vlist-t{border-collapse:collapse;display:inline-table;table-layout:fixed}.katex .vlist-r{display:table-row}.katex .vlist{display:table-cell;position:relative;vertical-align:bottom}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist>span>span{display:inline-block}.katex .vlist>span>.pstrut{overflow:hidden;width:0}.katex .vlist-t2{margin-right:-2px}.katex .vlist-s{display:table-cell;font-size:1px;min-width:2px;vertical-align:bottom;width:2px}.katex .msupsub{text-align:left}.katex .rule{min-height:1px}.katex .mspace{display:inline-block}.katex .rule{border:0 solid;display:inline-block;position:relative}.katex .sizing.reset-size6.size3{font-size:.7em}.katex .mtable .arraycolsep{display:inline-block}.katex .mtable .col-align-c>.vlist-t{text-align:center}.katex .svg-align{text-align:left}.katex svg{fill:currentColor;stroke:currentColor;fill-rule:nonzero;fill-opacity:1;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;display:block;height:inherit;position:absolute;width:100%}.katex svg path{stroke:none}.katex .hide-tail{overflow:hidden;position:relative;width:100%}.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:block;text-align:center;white-space:nowrap}.katex-display>.katex>.katex-html{display:block;position:relative}body{counter-reset:katexEqnNo mmlEqnNo}.prose p{line-height:1.55!important}.prose ul{margin:0!important}.prose a{font-weight:400;--un-text-opacity:1;color:rgba(23,114,208,var(--un-text-opacity));text-decoration:none}.prose a:hover{text-decoration-line:underline}.prose hr{border-top:1px solid #e5e7eb}.prose .katex-display{overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch}.prose .katex{font-size:1.1em}html:not(.dark) .prose .shiki-dark{display:none}.prose div[class*=language-]{position:relative;margin-top:.5rem;margin-bottom:.5rem;border-width:1px;--un-border-opacity:1;border-color:rgba(209,213,219,var(--un-border-opacity));border-radius:.375rem;padding-top:1.5rem}.prose div[class*=language-]:before{position:absolute;top:.875rem;left:1rem;width:.625rem;height:.625rem;border-radius:9999px;--un-bg-opacity:1;background-color:rgba(253,95,87,var(--un-bg-opacity));content:"";box-shadow:16px 0 #febb2f,32px 0 #2ec841}.prose div[class*=language-]>span.lang{position:absolute;top:.625rem;right:.75rem;font-size:.875rem;line-height:1.25rem;opacity:.6}.prose .shiki{margin:0;background-color:transparent!important;padding:1rem;font-size:.925em;line-height:1.5rem}.prose .shiki code{display:block;width:fit-content;min-width:100%}.prose .shiki code>span.highlighted{margin-left:-1rem;margin-right:-1rem;display:inline-block;padding-left:1rem;padding-right:1rem;width:calc(100% + 32px)}.prose .shiki-light code>span.highlighted{--un-bg-opacity:1;background-color:rgba(241,245,249,var(--un-bg-opacity))}.prose .shiki-dark code>span.highlighted{--un-bg-opacity:1;background-color:rgba(71,85,105,var(--un-bg-opacity))}.post a.header-anchor{float:left;--un-text-opacity:1;color:rgba(31,41,55,var(--un-text-opacity));text-decoration:none;opacity:0;margin-left:-1.3em;font-size:.75em}.post h2:focus .header-anchor,.post h2:hover .header-anchor,.post h3:focus .header-anchor,.post h3:hover .header-anchor{opacity:.5}@media (max-width:640px){.post a.header-anchor{display:none}}.table-of-contents{position:fixed;top:5rem;right:0;bottom:0;z-index:30;display:none;width:13.75rem;overflow-y:auto;overflow-x:hidden;text-overflow:ellipsis;padding-top:4.5rem;padding-right:1.375rem;text-align:right;font-size:.8em}.toc-open .table-of-contents{display:block}.table-of-contents ul{margin:0!important;list-style-type:none!important}.table-of-contents ul>li>a{--un-text-opacity:1;color:rgba(31,41,55,var(--un-text-opacity))}.table-of-contents>ul>li:before{margin-right:.25rem;opacity:.6;content:"#"}.table-of-contents>ul>li>ul>li{opacity:.6}.table-of-contents::-webkit-scrollbar{display:none}@media (max-width:1200px){.table-of-contents{top:0;border-left-width:1px;--un-border-opacity:1;border-color:rgba(229,231,235,var(--un-border-opacity));--un-bg-opacity:1;background-color:rgba(255,255,255,var(--un-bg-opacity));--un-shadow:var(--un-shadow-inset) 0 1px 3px 0 var(--un-shadow-color, rgba(0,0,0,.1)),var(--un-shadow-inset) 0 1px 2px -1px var(--un-shadow-color, rgba(0,0,0,.1));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}}@font-face{font-family:Computer Modern Sans;font-style:normal;font-weight:400;src:url(/assets/regular-5b933bfd.woff) format("woff")}@font-face{font-family:Computer Modern Sans;font-style:normal;font-weight:700;src:url(/assets/bold-48de7558.woff) format("woff")}@font-face{font-family:Computer Modern Sans;font-style:italic;font-weight:400;src:url(/assets/italic-c0fd060e.woff) format("woff")}@font-face{font-family:Computer Modern Sans;font-style:italic;font-weight:700;src:url(/assets/bolditalic-28145ed6.woff) format("woff")}#app,body,html{margin:0;height:100%;padding:0}.prev a[data-v-9b596018]:before{content:"\2190  "}.next a[data-v-9b596018]:after{content:" \2192"}</style><link rel="preload" href="/assets/index-335b24fd.css" as="style"><link rel="modulepreload" crossorigin="" href="/assets/post-44ffb393.js"><link rel="preload" href="/assets/post-1d6a6dca.css" as="style"><link rel="modulepreload" crossorigin="" href="/assets/2022-12-19-monocular-visual-odometry-27297d8a.js"><title>Implement Monocular Visual Odometry</title><meta name="description" content="A dragon lost in human world."><meta name="theme-color" content="#ffffff"><meta property="og:title" content="Implement Monocular Visual Odometry"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/dmsans/v11/rP2Hp2ywxg089UriCZ2IHSeH.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/dmsans/v11/rP2Hp2ywxg089UriCZOIHQ.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/dmsans/v11/rP2Cp2ywxg089UriASitCBamC2QX.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/dmsans/v11/rP2Cp2ywxg089UriASitCBimCw.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_AMS-Regular-0cdd387c.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Caligraphic-Bold-de7701e4.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Caligraphic-Regular-5d53e70a.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Fraktur-Bold-74444efd.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Fraktur-Regular-51814d27.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-Bold-0f60d1b8.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-BoldItalic-99cd42a3.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-Italic-97479ca6.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-Regular-c2342cd8.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Math-BoldItalic-dc47344d.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Math-Italic-7af58c5e.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_SansSerif-Bold-e99ae511.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_SansSerif-Italic-00b26ac8.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_SansSerif-Regular-68e8c73e.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Script-Regular-036d4e95.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Size1-Regular-6b47c401.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Size2-Regular-d04c5421.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="data:font/woff2;base64,d09GMgABAAAAAA4oAA4AAAAAHbQAAA3TAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAABmAAgRQIDgmcDBEICo1oijYBNgIkA14LMgAEIAWJAAeBHAyBHBvbGiMRdnO0IkRRkiYDgr9KsJ1NUAf2kILNxgUmgqIgq1P89vcbIcmsQbRps3vCcXdYOKSWEPEKgZgQkprQQsxIXUgq0DqpGKmIvrgkeVGtEQD9DzAO29fM9jYhxZEsL2FeURH2JN4MIcTdO049NCVdxQ/w9NrSYFEBKTDKpLKfNkCGDc1RwjZLQcm3vqJ2UW9Xfa3tgAHz6ivp6vgC2yD4/6352ndnN0X0TL7seypkjZlMsjmZnf0Mm5Q+JykRWQBKCVCVPbARPXWyQtb5VgLB6Biq7/Uixcj2WGqdI8tGSgkuRG+t910GKP2D7AQH0DB9FMDW/obJZ8giFI3Wg8Cvevz0M+5m0rTh7XDBlvo9Y4vm13EXmfttwI4mBo1EG15fxJhUiCLbiiyCf/ZA6MFAhg3pGIZGdGIVjtPn6UcMk9A/UUr9PhoNsCENw1APAq0gpH73e+M+0ueyHbabc3vkbcdtzcf/fiy+NxQEjf9ud/ELBHAXJ0nk4z+MXH2Ev/kWyV4k7SkvpPc9Qr38F6RPWnM9cN6DJ0AdD1BhtgABtmoRoFCvPsBAumNm6soZG2Gk5GyVTo2sJncSyp0jQTYoR6WDvTwaaEcHsxHfvuWhHA3a6bN7twRKtcGok6NsCi7jYRrM2jExsUFMxMQYuJbMhuWNOumEJy9hi29Dmg5zMp/A5+hhPG19j1vBrq8JTLr8ki5VLPmG/PynJHVul440bxg5xuymHUFPBshC+nA9I1FmwbRBTNHAcik3Oae0cxKoI3MOriM42UrPe51nsaGxJ+WfXubAsP84aabUlQSJ1IiE0iPETLUU4CATgfXSCSpuRFRmCGbO+wSpAnzaeaCYW1VNEysRtuXCEL1kUFUbbtMv3Tilt/1c11jt3Q5bbMa84cpWipp8Elw3MZhOHsOlwwVUQM3lAR35JiFQbaYCRnMF2lxAWoOg2gyoIV4PouX8HytNIfLhqpJtXB4vjiViUI8IJ7bkC4ikkQvKksnOTKICwnqWSZ9YS5f0WCxmpgjbIq7EJcM4aI2nmhLNY2JIUgOjXZFWBHb+x5oh6cwb0Tv1ackHdKi0I9OO2wE9aogIOn540CCCziyhN+IaejtgAONKznHlHyutPrHGwCx9S6B8kfS4Mfi4Eyv7OU730bT1SCBjt834cXsf43zVjPUqqJjgrjeGnBxSG4aYAKFuVbeCfkDIjAqMb6yLNIbCuvXhMH2/+k2vkNpkORhR59N1CkzoOENvneIosjYmuTxlhUzaGEJQ/iWqx4dmwpmKjrwTiTGTCVozNAYqk/zXOndWxuWSmJkQpJw3pK5KX6QrLt5LATMqpmPAQhkhK6PUjzHUn7E0gHE0kPE0iKkolgkUx9SZmVAdDgpffdyJKg3k7VmzYGCwVXGz/tXmkOIp+vcWs+EMuhhvN0h9uhfzWJziBQmCREGSIFmQIkgVpAnSBRmC//6hkLZwaVhwxlrJSOdqlFtOYxlau9F2QN5Y98xmIAsiM1HVp2VFX+DHHGg6Ecjh3vmqtidX3qHI2qycTk/iwxSt5UzTmEP92ZBnEWTk4Mx8Mpl78ZDokxg/KWb+Q0QkvdKVmq3TMW+RXEgrsziSAfNXFMhDc60N5N9jQzjfO0kBKpUZl0ZmwJ41j/B9Hz6wmRaJB84niNmQrzp9eSlQCDDzazGDdVi3P36VZQ+Jy4f9UBNp+3zTjqI4abaFAm+GShVaXlsGdF3FYzZcDI6cori4kMxUECl9IjJZpzkvitAoxKue+90pDMvcKRxLl53TmOKCmV/xRolNKSqqUxc6LStOETmFOiLZZptlZepcKiAzteG8PEdpnQpbOMNcMsR4RR2Bs0cKFEvSmIjAFcnarqwUL4lDhHmnVkwu1IwshbiCcgvOheZuYyOteufZZwlcTlLgnZ3o/WcYdzZHW/WGaqaVfmTZ1aWCceJjkbZqsfbkOtcFlUZM/jy+hXHDbaUobWqqXaeWobbLO99yG5N3U4wxco0rQGGcOLASFMXeJoham8M+/x6O2WywK2l4HGbq1CoUyC/IZikQhdq3SiuNrvAEj0AVu9x2x3lp/xWzahaxidezFVtdcb5uEnzyl0ZmYiuKI0exvCd4Xc9CV1KB0db00z92wDPde0kukbvZIWN6jUWFTmPIC/Y4UPCm8UfDTFZpZNon1qLFTkBhxzB+FjQRA2Q/YRJT8pQigslMaUpFyAG8TMlXigiqmAZX4xgijKjRlGpLE0GdplRfCaJo0JQaSxNBk6ZmMzcya0FmrcisDdn0Q3HI2sWSppYigmlM1XT/kLQZSNpMJG0WkjYbSZuDpM1F0uYhFc1HxU4m1QJjDK6iL0S5uSj5rgXc3RejEigtcRBtqYPQsiTskmO5vosV+q4VGIKbOkDg0jtRrq+Em1YloaTFar3EGr1EUC8R0kus1Uus00usL97ABr2BjXoDm/QGNhuWtMVBKOwg/i78lT7hBsAvDmwHc/ao3vmUbBmhjeYySZNWvGkfZAgISDSaDo1SVpzGDsAEkF8B+gEapViUoZgUWXcRIGFZNm6gWbAKk0bp0k1MHG9fLYtV4iS2SmLEQFARzRcnf9PUS0LVn05/J9MiRRBU3v2IrvW974v4N00L7ZMk0wXP1409CHo/an8zTRHD3eSJ6m8D4YMkZNl3M79sqeuAsr/m3f+8/yl7A50aiAEJgeBeMWzu7ui9UfUBCe2TIqZIoOd/3/udRBOQidQZUERzb2/VwZN1H/Sju82ew2H2Wfr6qvfVf3hqwDvAIpkQVFy4B9Pe9e4/XvPeceu7h3dvO56iJPf0+A6cqA2ip18ER+iFgggiuOkvj24bby0N9j2UHIkgqIt+sVgfodC4YghLSMjSZbH0VR/6dMDrYJeKHilKTemt6v6kvzvn3/RrdWtr0GoN/xL+Sex/cPYLUpepx9cz/D46UPU5KXgAQa+NDps1v6J3xP1i2HtaDB0M9aX2deA7SYff//+gUCovMmIK/qfsFcOk+4Y5ZN97XlG6zebqtMbKgeRFi51vnxTQYBUik2rS/Cn6PC8ADR8FGxsRPB82dzfND90gIcshOcYUkfjherBz53odpm6TP8txlwOZ71xmfHHOvq053qFF/MRlS3jP0ELudrf2OeN8DHvp6ZceLe8qKYvWz/7yp0u4dKPfli3CYq0O13Ih71mylJ80tOi10On8wi+F4+LWgDPeJ30msSQt9/vkmHq9/Lvo2b461mP801v3W4xTcs6CbvF9UDdrSt+A8OUbpSh55qAUFXWznBBfdeJ8a4d7ugT5tvxUza3h9m4H7ptTqiG4z0g5dc0X29OcGlhpGFMpQo9ytTS+NViZpNdvU4kWx+LKxNY10kQ1yqGXrhe4/1nvP7E+nd5A92TtaRplbHSqoIdOqtRWti+fkB5/n1+/VvCmz12pG1kpQWsfi1ftlBobm0bpngs16CHkbIwdLnParxtTV3QYRlfJ0KFskH7pdN/YDn+yRuSd7sNH3aO0DYPggk6uWuXrfOc+fa3VTxFVvKaNxHsiHmsXyCLIE5yuOeN3/Jdf8HBL/5M6shjyhxHx9BjB1O0+4NLOnjLLSxwO7ukN4jMbOIcD879KLSi6Pk61Oqm2377n8079PXEEQ7cy7OKEC9nbpet118fxweTafpt69x/Bt8UqGzNQt7aelpc44dn5cqhwf71+qKp/Zf/+a0zcizOUWpl/iBcSXip0pplkatCchoH5c5aUM8I7/dWxAej8WicPL1URFZ9BDJelUwEwTkGqUhgSlydVes95YdXvhh9Gfz/aeFWvgVb4tuLbcv4+wLdutVZv/cUonwBD/6eDlE0aSiKK/uoH3+J1wDE/jMVqY2ysGufN84oIXB0sPzy8ollX/LegY74DgJXJR57sn+VGza0x3DnuIgABFM15LmajjjsNlYj+JEZGbuRYcAMOWxFkPN2w6Wd46xo4gVWQR/X4lyI/R6K/YK0110GzudPRW7Y+UOBGTfNNzHeYT0fiH0taunBpq9HEW8OKSaBGj21L0MqenEmNRWBAWDWAk4CpNoEZJ2tTaPFgbQYj8HxtFilErs3BTRwT8uO1NXQaWfIotchmPkAF5mMBAliEmZiOGVgCG9LgRzpscMAOOwowlT3JhusdazXGSC/hxR3UlmWVwWHpOIKheqONvjyhSiTHIkVUco5bnji8m//zL7PKaT1Vl5I6UE609f+gkr6MZKVyKc7zJRmCahLsdlyA5fdQkRSan9LgnnLEyGSkaKJCJog0wAgvepWBt80+1yKln1bMVtCljfNWDueKLsWwaEbBSfSPTEmVRsUcYYMnEjcjeyCZzBXK9E9BYBXLKjOSpUDR+nEV3TFSUdQaz+ot98QxgXwx0GQ+EEUAKB2qZPkQQ0GqFD8UPFMqyaCHM24BZmSGic9EYMagKizOw9Hz50DMrDLrqqLkTAhplMictiCAx5S3BIUQdeJeLnBy2CNtMfz6cV4u8XKoFZQesbf9YZiIERiHjaNodDW6LgcirX/mPnJIkBGDUpTBhSa0EIr38D5hCIszhCM8URGBqImoWjpvpt1ebu/v3Gl3qJfMnNM+9V+kiRFyROTPHQWOcs1dNW94/ukKMPZBvDi55i5CttdeJz84DLngLqjcdwEZ87bFFR8CIG35OAkDVN6VRDZ7aq67NteYqZ2lpT8oYB2CytoBd6VuAx4WgiAsnuj3WohG+LugzXiQRDeM3XYXlULv4dp5VFYC"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Size4-Regular-a4af7d41.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Typewriter-Regular-71d517d6.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/regular-5b933bfd.woff"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/bold-48de7558.woff"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/italic-c0fd060e.woff"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/bolditalic-28145ed6.woff"></head><body class="font-sans"><div id="app" data-server-rendered="true"><main class="flex flex-col min-h-full text-c post" p="x-4 t-24 b-6" data-v-9b596018=""><header class="z-40 w-full h-14 flex justify-between items-center bg-c font-ui absolute top-0 left-0" p="x-4 md:x-5" data-v-4d808a77=""><a href="/" class="font-bold" un-text="c-light hover:c-dark" data-v-4d808a77=""><span text="lg" data-v-4d808a77="">hi@zxh</span><div i-fa6-solid:angle-right="" class="prompt inline-block" data-v-4d808a77=""></div><span class="blink" data-v-4d808a77="">_</span></a><nav flex="" space-x-4="" data-v-4d808a77=""><a href="/projects" class="" nav-item="" title="Projects" data-v-4d808a77=""><div i-ph:rocket-launch-duotone="" md:hidden="" data-v-4d808a77=""></div><span class="lt-md:hidden" data-v-4d808a77="">Projects</span></a><a href="/posts" class="" nav-item="" title="Blog" data-v-4d808a77=""><div i-majesticons:pencil-line="" md:hidden="" data-v-4d808a77=""></div><span class="lt-md:hidden" data-v-4d808a77="">Blog</span></a><a nav-item="" href="/feed.xml" title="RSS" target="_blank" rel="noopener noreferrer" data-v-4d808a77=""><div i-jam:rss-feed="" data-v-4d808a77=""></div></a><button nav-item="" title="Toggle dark" data-v-4d808a77=""><div i="carbon-sun dark:carbon-moon" data-v-4d808a77=""></div></button><!--[--><!--]--></nav></header><div class="flex-1 mb-6"><!--[--><div prose-lg="" mx-auto="" mt-6="" mb-8="" data-v-9b596018=""><h1 class="text-4xl font-bold leading-12" data-v-9b596018="">Implement Monocular Visual Odometry</h1><p class="opacity-50 mt-2" data-v-9b596018="">Dec 19, 2022 · 11 min <span data-v-9b596018="">· <span i-uil:tag-alt="" mr-1="" text-sm="" data-v-9b596018=""></span><!--[--><span data-v-9b596018=""><a href="/posts/tags/computer-vision" class="" hover:underline="" data-v-9b596018="">computer vision</a><!----></span><!--]--></span></p></div><article class="toc-open" data-v-9b596018=""><div class="prose prose-lg m-auto text-left" data-v-9b596018=""><p></p><div class="table-of-contents"><ul><li><a href="#problem">Problem</a></li><li><a href="#feature-detection">Feature Detection</a></li><li><a href="#feature-tracking">Feature Tracking</a></li><li><a href="#fundamental-matrix">Fundamental Matrix</a><ul><li><a href="#eight-point-algorithm">Eight Point Algorithm</a></li><li><a href="#ransac">RANSAC</a></li></ul></li><li><a href="#essential-matrix">Essential Matrix</a></li><li><a href="#camera-pose">Camera Pose</a></li><li><a href="#trajectory">Trajectory</a></li><li><a href="#references">References</a></li></ul></div><p></p><p>Monocular Visual Odometry (VO) is the process of estimating the pose (position and orientation) of a camera using only visual information from a single camera. It is a crucial component of many robotics and augmented reality systems, as it allows a device to understand its own movement and position in the world.</p><p>This blog would be focussing on how to implement a simple monocular VO algorithm in Python. If you are new to it, I suggest having a look at <a href="https://cmsc426.github.io/sfm/" target="_blank" rel="noopener noreferrer">this article</a>.</p><p>The overall process can be broken down into the following steps:</p><ul><li>Feature detection</li><li>Feature tracking</li><li>Estimating fundamental matrix</li><li>Estimating essential matrix (from fundamental matrix)</li><li>Recovering pose (from essential matrix)</li></ul><h2 id="problem" tabindex="-1">Problem <a class="header-anchor" href="#problem" aria-hidden="true">#</a></h2><p>Suppose that we have a camera attached to a vehicle. A video coming from this camera has been processed for lens distortion and converted to frames. We denote the frames captured at time <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6595em"></span><span class="mord mathnormal">i</span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7429em;vertical-align:-.0833em"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6444em"></span><span class="mord">1</span></span></span></span> as <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0785em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8917em;vertical-align:-.2083em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0785em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2083em"><span></span></span></span></span></span></span></span></span></span>, respectively. For every pair of images <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0785em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0785em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2083em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>, our job is to find the rotation matrix <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> and the translation vector <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7651em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>, which describe the motion of the vehicle between the two frames.</p><h2 id="feature-detection" tabindex="-1">Feature Detection <a class="header-anchor" href="#feature-detection" aria-hidden="true">#</a></h2><p>We first look for salient landmarks, called keypoints <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0715em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>, in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0785em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>. Keypoints are features that differ from their immediate neighborhood such as corners or areas with unique colors or textures. These features should ideally be found in both two adjacent frames.</p><p>Using OpenCV, detecting keypoints is trivial:</p><div class="language-python"><span class="lang">python</span><pre class="shiki github-dark-dimmed shiki-dark"><code v-pre=""><span class="line"><span style="color:#f47067">import</span><span style="color:#adbac7"> cv2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#f47067">def</span><span style="color:#adbac7"> </span><span style="color:#dcbdfb">detect_features</span><span style="color:#adbac7">(image):</span></span>
<span class="line"><span style="color:#adbac7">    detector </span><span style="color:#f47067">=</span><span style="color:#adbac7"> cv2.GFTTDetector_create()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    kp </span><span style="color:#f47067">=</span><span style="color:#adbac7"> detector.detect(image)</span></span>
<span class="line"><span style="color:#adbac7">    kp </span><span style="color:#f47067">=</span><span style="color:#adbac7"> cv2.KeyPoint_convert(</span><span style="color:#6cb6ff">sorted</span><span style="color:#adbac7">(kp, </span><span style="color:#f69d50">key</span><span style="color:#f47067">=lambda</span><span style="color:#adbac7"> p: p.response, </span><span style="color:#f69d50">reverse</span><span style="color:#f47067">=</span><span style="color:#6cb6ff">True</span><span style="color:#adbac7">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">return</span><span style="color:#adbac7"> kp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">kp1 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> detect_features(image1)</span></span>
<span class="line"></span></code></pre><pre class="shiki github-light shiki-light"><code v-pre=""><span class="line"><span style="color:#d73a49">import</span><span style="color:#24292e"> cv2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49">def</span><span style="color:#24292e"> </span><span style="color:#6f42c1">detect_features</span><span style="color:#24292e">(image):</span></span>
<span class="line"><span style="color:#24292e">    detector </span><span style="color:#d73a49">=</span><span style="color:#24292e"> cv2.GFTTDetector_create()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    kp </span><span style="color:#d73a49">=</span><span style="color:#24292e"> detector.detect(image)</span></span>
<span class="line"><span style="color:#24292e">    kp </span><span style="color:#d73a49">=</span><span style="color:#24292e"> cv2.KeyPoint_convert(</span><span style="color:#005cc5">sorted</span><span style="color:#24292e">(kp, </span><span style="color:#e36209">key</span><span style="color:#d73a49">=lambda</span><span style="color:#24292e"> p: p.response, </span><span style="color:#e36209">reverse</span><span style="color:#d73a49">=</span><span style="color:#005cc5">True</span><span style="color:#24292e">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">return</span><span style="color:#24292e"> kp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">kp1 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> detect_features(image1)</span></span>
<span class="line"></span></code></pre></div><p>Here GFTT (Good Features to Track) detector is used to detect keypoints. In my experiments, other detectors like SIFT (Scale Invariant Feature Transform) and ORB (Oriented Fast and Rotated Brief) perform worse than GFTT. Meanwhile, the speed of SIFT is much slower.</p><h2 id="feature-tracking" tabindex="-1">Feature Tracking <a class="header-anchor" href="#feature-tracking" aria-hidden="true">#</a></h2><p>We then need to track <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0715em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>’s corresponding keypoints <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8917em;vertical-align:-.2083em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0715em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2083em"><span></span></span></span></span></span></span></span></span></span> in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8917em;vertical-align:-.2083em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0785em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2083em"><span></span></span></span></span></span></span></span></span></span> using optical flow. To improve the performance, you can choose to remove the keypoints that are not tracked in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8917em;vertical-align:-.2083em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0785em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2083em"><span></span></span></span></span></span></span></span></span></span> (<code>status</code> returned by <code>cv2.calcOpticalFlowPyrLK</code> is 0) or are outside <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8917em;vertical-align:-.2083em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0785em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2083em"><span></span></span></span></span></span></span></span></span></span>.</p><div class="language-python"><span class="lang">python</span><pre class="shiki github-dark-dimmed shiki-dark"><code v-pre=""><span class="line"><span style="color:#f47067">def</span><span style="color:#adbac7"> </span><span style="color:#dcbdfb">get_removed_pts_ids</span><span style="color:#adbac7">(pts, image, status):</span></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#96d0ff">"""Removes keypoints that are not tracked or are outside the image."""</span></span>
<span class="line"><span style="color:#adbac7">    status_ </span><span style="color:#f47067">=</span><span style="color:#adbac7"> status.copy()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">for</span><span style="color:#adbac7"> idx, pt </span><span style="color:#f47067">in</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">enumerate</span><span style="color:#adbac7">(pts):</span></span>
<span class="line"><span style="color:#adbac7">        </span><span style="color:#f47067">if</span><span style="color:#adbac7"> pt[</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">] </span><span style="color:#f47067">&lt;</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7"> </span><span style="color:#f47067">or</span><span style="color:#adbac7"> pt[</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">] </span><span style="color:#f47067">&lt;</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7"> </span><span style="color:#f47067">or</span><span style="color:#adbac7"> pt[</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">] </span><span style="color:#f47067">&gt;</span><span style="color:#adbac7"> image.shape[</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">] </span><span style="color:#f47067">or</span><span style="color:#adbac7"> pt[</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">] </span><span style="color:#f47067">&gt;</span><span style="color:#adbac7"> image.shape[</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">]:</span></span>
<span class="line"><span style="color:#adbac7">            status_[idx] </span><span style="color:#f47067">=</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">return</span><span style="color:#adbac7"> np.where(status_ </span><span style="color:#f47067">==</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">)[</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#f47067">def</span><span style="color:#adbac7"> </span><span style="color:#dcbdfb">track_features</span><span style="color:#adbac7">(image1, image2, kp1, remove_outliers: </span><span style="color:#6cb6ff">bool</span><span style="color:#adbac7"> </span><span style="color:#f47067">=</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">False</span><span style="color:#adbac7">):</span></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#96d0ff">"""Tracks features using optical flow."""</span></span>
<span class="line"><span style="color:#adbac7">    kp2, status, _ </span><span style="color:#f47067">=</span><span style="color:#adbac7"> cv2.calcOpticalFlowPyrLK(image1, image2, kp1, </span><span style="color:#6cb6ff">None</span><span style="color:#adbac7">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">if</span><span style="color:#adbac7"> remove_outliers:</span></span>
<span class="line"><span style="color:#adbac7">        removed_ids </span><span style="color:#f47067">=</span><span style="color:#adbac7"> get_removed_pts_ids(kp2, image2, status)</span></span>
<span class="line"><span style="color:#adbac7">        kp1 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.delete(kp1, removed_ids, </span><span style="color:#f69d50">axis</span><span style="color:#f47067">=</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">)</span></span>
<span class="line"><span style="color:#adbac7">        kp2 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.delete(kp2, removed_ids, </span><span style="color:#f69d50">axis</span><span style="color:#f47067">=</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">return</span><span style="color:#adbac7"> kp1, kp2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">kp1, kp2 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> track_features(image1, image2, kp1, </span><span style="color:#f69d50">remove_outliers</span><span style="color:#f47067">=</span><span style="color:#6cb6ff">True</span><span style="color:#adbac7">)</span></span>
<span class="line"></span></code></pre><pre class="shiki github-light shiki-light"><code v-pre=""><span class="line"><span style="color:#d73a49">def</span><span style="color:#24292e"> </span><span style="color:#6f42c1">get_removed_pts_ids</span><span style="color:#24292e">(pts, image, status):</span></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#032f62">"""Removes keypoints that are not tracked or are outside the image."""</span></span>
<span class="line"><span style="color:#24292e">    status_ </span><span style="color:#d73a49">=</span><span style="color:#24292e"> status.copy()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">for</span><span style="color:#24292e"> idx, pt </span><span style="color:#d73a49">in</span><span style="color:#24292e"> </span><span style="color:#005cc5">enumerate</span><span style="color:#24292e">(pts):</span></span>
<span class="line"><span style="color:#24292e">        </span><span style="color:#d73a49">if</span><span style="color:#24292e"> pt[</span><span style="color:#005cc5">0</span><span style="color:#24292e">] </span><span style="color:#d73a49">&lt;</span><span style="color:#24292e"> </span><span style="color:#005cc5">0</span><span style="color:#24292e"> </span><span style="color:#d73a49">or</span><span style="color:#24292e"> pt[</span><span style="color:#005cc5">1</span><span style="color:#24292e">] </span><span style="color:#d73a49">&lt;</span><span style="color:#24292e"> </span><span style="color:#005cc5">0</span><span style="color:#24292e"> </span><span style="color:#d73a49">or</span><span style="color:#24292e"> pt[</span><span style="color:#005cc5">0</span><span style="color:#24292e">] </span><span style="color:#d73a49">&gt;</span><span style="color:#24292e"> image.shape[</span><span style="color:#005cc5">1</span><span style="color:#24292e">] </span><span style="color:#d73a49">or</span><span style="color:#24292e"> pt[</span><span style="color:#005cc5">1</span><span style="color:#24292e">] </span><span style="color:#d73a49">&gt;</span><span style="color:#24292e"> image.shape[</span><span style="color:#005cc5">0</span><span style="color:#24292e">]:</span></span>
<span class="line"><span style="color:#24292e">            status_[idx] </span><span style="color:#d73a49">=</span><span style="color:#24292e"> </span><span style="color:#005cc5">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">return</span><span style="color:#24292e"> np.where(status_ </span><span style="color:#d73a49">==</span><span style="color:#24292e"> </span><span style="color:#005cc5">0</span><span style="color:#24292e">)[</span><span style="color:#005cc5">0</span><span style="color:#24292e">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49">def</span><span style="color:#24292e"> </span><span style="color:#6f42c1">track_features</span><span style="color:#24292e">(image1, image2, kp1, remove_outliers: </span><span style="color:#005cc5">bool</span><span style="color:#24292e"> </span><span style="color:#d73a49">=</span><span style="color:#24292e"> </span><span style="color:#005cc5">False</span><span style="color:#24292e">):</span></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#032f62">"""Tracks features using optical flow."""</span></span>
<span class="line"><span style="color:#24292e">    kp2, status, _ </span><span style="color:#d73a49">=</span><span style="color:#24292e"> cv2.calcOpticalFlowPyrLK(image1, image2, kp1, </span><span style="color:#005cc5">None</span><span style="color:#24292e">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">if</span><span style="color:#24292e"> remove_outliers:</span></span>
<span class="line"><span style="color:#24292e">        removed_ids </span><span style="color:#d73a49">=</span><span style="color:#24292e"> get_removed_pts_ids(kp2, image2, status)</span></span>
<span class="line"><span style="color:#24292e">        kp1 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.delete(kp1, removed_ids, </span><span style="color:#e36209">axis</span><span style="color:#d73a49">=</span><span style="color:#005cc5">0</span><span style="color:#24292e">)</span></span>
<span class="line"><span style="color:#24292e">        kp2 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.delete(kp2, removed_ids, </span><span style="color:#e36209">axis</span><span style="color:#d73a49">=</span><span style="color:#005cc5">0</span><span style="color:#24292e">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">return</span><span style="color:#24292e"> kp1, kp2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">kp1, kp2 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> track_features(image1, image2, kp1, </span><span style="color:#e36209">remove_outliers</span><span style="color:#d73a49">=</span><span style="color:#005cc5">True</span><span style="color:#24292e">)</span></span>
<span class="line"></span></code></pre></div><h2 id="fundamental-matrix" tabindex="-1">Fundamental Matrix <a class="header-anchor" href="#fundamental-matrix" aria-hidden="true">#</a></h2><p>The fundamental matrix <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.13889em">F</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:.667em;height:3.6em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">33</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:.667em;height:3.6em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span></span></span></span> is a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7278em;vertical-align:-.0833em"></span><span class="mord">3</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6444em"></span><span class="mord">3</span></span></span></span> matrix that encodes the relative orientation and position of the camera between <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0785em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8917em;vertical-align:-.2083em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0785em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2083em"><span></span></span></span></span></span></span></span></span></span>.</p><h3 id="eight-point-algorithm" tabindex="-1">Eight Point Algorithm <a class="header-anchor" href="#eight-point-algorithm" aria-hidden="true">#</a></h3><p>To estimate <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.13889em">F</span></span></span></span>, one of the solutions is <a href="https://www.cs.cmu.edu/~16385/s17/Slides/12.4_8Point_Algorithm.pdf" target="_blank" rel="noopener noreferrer">Hartley’s normalized 8-point algorithm</a>, where the constraint for <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.13889em">F</span></span></span></span> is:</p><p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:10.8001em;vertical-align:-5.1501em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35em"><span style="top:-4.35em"><span class="pstrut" style="height:6.2em"></span><span style="width:.667em;height:4.2em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="4.200em" viewBox="0 0 667 4200"><path d="M403 1759 V84 H666 V0 H319 V1759 v600 v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v600 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.85em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.38em"><span style="top:-5.2275em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.317em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2587em"><span></span></span></span></span></span></span></span></span><span style="top:-3.3675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0;border-top-width:1.5em;bottom:0"></span></span></span></span><span style="top:-2.1675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.317em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2587em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.88em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.38em"><span style="top:-5.2275em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.317em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2587em"><span></span></span></span></span></span></span></span></span><span style="top:-3.3675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0;border-top-width:1.5em;bottom:0"></span></span></span></span><span style="top:-2.1675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.317em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2587em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.88em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.38em"><span style="top:-5.2275em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.317em"><span></span></span></span></span></span></span></span></span><span style="top:-3.3675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0;border-top-width:1.5em;bottom:0"></span></span></span></span><span style="top:-2.1675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.317em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.88em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.38em"><span style="top:-5.2275em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.317em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2587em"><span></span></span></span></span></span></span></span></span><span style="top:-3.3675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0;border-top-width:1.5em;bottom:0"></span></span></span></span><span style="top:-2.1675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.317em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2587em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.88em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.38em"><span style="top:-5.2275em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.317em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2587em"><span></span></span></span></span></span></span></span></span><span style="top:-3.3675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0;border-top-width:1.5em;bottom:0"></span></span></span></span><span style="top:-2.1675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.317em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2587em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.88em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.38em"><span style="top:-5.2275em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.317em"><span></span></span></span></span></span></span></span></span><span style="top:-3.3675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0;border-top-width:1.5em;bottom:0"></span></span></span></span><span style="top:-2.1675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.317em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.88em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.38em"><span style="top:-5.2275em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2587em"><span></span></span></span></span></span></span></span></span><span style="top:-3.3675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0;border-top-width:1.5em;bottom:0"></span></span></span></span><span style="top:-2.1675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2587em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.88em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.38em"><span style="top:-5.2275em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2587em"><span></span></span></span></span></span></span></span></span><span style="top:-3.3675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0;border-top-width:1.5em;bottom:0"></span></span></span></span><span style="top:-2.1675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4413em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2587em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.88em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.38em"><span style="top:-5.2275em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.3675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0;border-top-width:1.5em;bottom:0"></span></span></span></span><span style="top:-2.1675em"><span class="pstrut" style="height:3.6875em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.88em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35em"><span style="top:-4.35em"><span class="pstrut" style="height:6.2em"></span><span style="width:.667em;height:4.2em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="4.200em" viewBox="0 0 667 4200"><path d="M347 1759 V0 H0 V84 H263 V1759 v600 v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v600 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.85em"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.1667em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.6499em"><span style="top:-7.6499em"><span class="pstrut" style="height:12.8em"></span><span style="width:.667em;height:10.8em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="10.800em" viewBox="0 0 667 10800"><path d="M403 1759 V84 H666 V0 H319 V1759 v7200 v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v7200 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.1501em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.65em"><span style="top:-7.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-6.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-5.41em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:.59em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:1.79em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1076em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">33</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.15em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.6499em"><span style="top:-7.6499em"><span class="pstrut" style="height:12.8em"></span><span style="width:.667em;height:10.8em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="10.800em" viewBox="0 0 667 10800"><path d="M347 1759 V0 H0 V84 H263 V1759 v7200 v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v7200 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.1501em"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8389em;vertical-align:-.1944em"></span><span class="mord">0</span><span class="mpunct">,</span></span></span></span></span></p><p>which can be answered by solving the linear least squares using Singular Value Decomposition (SVD). This algorithm requires 8 keypoint correspondences exists, where <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> are the coordinates of the 8 keypoints selected from <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0715em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>, and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2083em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2083em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> are the coordinates of their corresponding keypoints in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8917em;vertical-align:-.2083em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0715em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2083em"><span></span></span></span></span></span></span></span></span></span>. The coordinates should be normalized by shifting them around the mean of the points and enclosing them at a distance of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-.1328em"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.9072em"><span class="svg-align" style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord" style="padding-left:.833em"><span class="mord">2</span></span></span><span style="top:-2.8672em"><span class="pstrut" style="height:3em"></span><span class="hide-tail" style="min-width:.853em;height:1.08em"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.1328em"><span></span></span></span></span></span></span></span></span> from the new center.</p><p>Given 8 keypoint correspondences, the code for computing <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.13889em">F</span></span></span></span> is:</p><div class="language-python"><span class="lang">python</span><pre class="shiki github-dark-dimmed shiki-dark"><code v-pre=""><span class="line"><span style="color:#f47067">import</span><span style="color:#adbac7"> numpy </span><span style="color:#f47067">as</span><span style="color:#adbac7"> np</span></span>
<span class="line"></span>
<span class="line"><span style="color:#f47067">def</span><span style="color:#adbac7"> </span><span style="color:#dcbdfb">normalize</span><span style="color:#adbac7">(pt: np.ndarray):</span></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#96d0ff">"""Normalizes the given set of points."""</span></span>
<span class="line"><span style="color:#adbac7">    N </span><span style="color:#f47067">=</span><span style="color:#adbac7"> pt.shape[</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">]</span></span>
<span class="line"><span style="color:#adbac7">    mean </span><span style="color:#f47067">=</span><span style="color:#adbac7"> pt </span><span style="color:#f47067">-</span><span style="color:#adbac7"> np.mean(pt, </span><span style="color:#f69d50">axis</span><span style="color:#f47067">=</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    scale </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.sum(np.square(pt)) </span><span style="color:#f47067">/</span><span style="color:#adbac7"> (</span><span style="color:#6cb6ff">2</span><span style="color:#adbac7"> </span><span style="color:#f47067">*</span><span style="color:#adbac7"> N)</span></span>
<span class="line"><span style="color:#adbac7">    scale </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.sqrt(</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7"> </span><span style="color:#f47067">/</span><span style="color:#adbac7"> scale)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">return</span><span style="color:#adbac7"> scale </span><span style="color:#f47067">*</span><span style="color:#adbac7"> mean, scale</span></span>
<span class="line"></span>
<span class="line"><span style="color:#f47067">def</span><span style="color:#adbac7"> </span><span style="color:#dcbdfb">compute_fundamental_mat</span><span style="color:#adbac7">(pt1: np.ndarray, pt2: np.ndarray)-&gt; np.ndarray:</span></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#96d0ff">"""Computes the fundamental matrix F using SVD."""</span></span>
<span class="line"><span style="color:#adbac7">    N </span><span style="color:#f47067">=</span><span style="color:#adbac7"> pt1.shape[</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    norm_pt1, scale1 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> normalize(pt1)</span></span>
<span class="line"><span style="color:#adbac7">    norm_pt2, scale2 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> normalize(pt2)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    T1 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.array([</span></span>
<span class="line"><span style="color:#adbac7">        [scale1, </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, </span><span style="color:#f47067">-</span><span style="color:#adbac7"> scale1 </span><span style="color:#f47067">*</span><span style="color:#adbac7"> np.mean(pt1[:, </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">])],</span></span>
<span class="line"><span style="color:#adbac7">        [</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, scale1, </span><span style="color:#f47067">-</span><span style="color:#adbac7"> scale1 </span><span style="color:#f47067">*</span><span style="color:#adbac7"> np.mean(pt1[:, </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">])],</span></span>
<span class="line"><span style="color:#adbac7">        [</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">]</span></span>
<span class="line"><span style="color:#adbac7">    ])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    T2 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.array([</span></span>
<span class="line"><span style="color:#adbac7">        [scale2, </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, </span><span style="color:#f47067">-</span><span style="color:#adbac7"> scale2 </span><span style="color:#f47067">*</span><span style="color:#adbac7"> np.mean(pt2[:, </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">])],</span></span>
<span class="line"><span style="color:#adbac7">        [</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, scale2, </span><span style="color:#f47067">-</span><span style="color:#adbac7"> scale2 </span><span style="color:#f47067">*</span><span style="color:#adbac7"> np.mean(pt2[:, </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">])],</span></span>
<span class="line"><span style="color:#adbac7">        [</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">]</span></span>
<span class="line"><span style="color:#adbac7">    ])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    A </span><span style="color:#f47067">=</span><span style="color:#adbac7"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">for</span><span style="color:#adbac7"> i </span><span style="color:#f47067">in</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">range</span><span style="color:#adbac7">(N):</span></span>
<span class="line"><span style="color:#adbac7">        x1, y1 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> norm_pt1[i]</span></span>
<span class="line"><span style="color:#adbac7">        x2, y2 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> norm_pt2[i]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        a </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.array([x2 </span><span style="color:#f47067">*</span><span style="color:#adbac7"> x1, x2 </span><span style="color:#f47067">*</span><span style="color:#adbac7"> y1, x2, y2 </span><span style="color:#f47067">*</span><span style="color:#adbac7"> x1, y2 </span><span style="color:#f47067">*</span><span style="color:#adbac7"> y1, y2, x1, y1, </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">])</span></span>
<span class="line"><span style="color:#adbac7">        A.append(a)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    A </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.array(A)  </span><span style="color:#768390"># (N, 9)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    U1, S1, V1 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.linalg.svd(A)</span></span>
<span class="line"><span style="color:#adbac7">    F </span><span style="color:#f47067">=</span><span style="color:#adbac7"> V1[</span><span style="color:#f47067">-</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">,:].reshape(</span><span style="color:#6cb6ff">3</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">3</span><span style="color:#adbac7">)</span></span>
<span class="line"><span style="color:#adbac7">    F </span><span style="color:#f47067">/=</span><span style="color:#adbac7"> F[</span><span style="color:#6cb6ff">2</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">2</span><span style="color:#adbac7">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    U2, S2, V2 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.linalg.svd(F)</span></span>
<span class="line"><span style="color:#adbac7">    S2 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.diag(S2)</span></span>
<span class="line"><span style="color:#adbac7">    S2[</span><span style="color:#f47067">-</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">] </span><span style="color:#f47067">=</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    F </span><span style="color:#f47067">=</span><span style="color:#adbac7"> U2 </span><span style="color:#f47067">@</span><span style="color:#adbac7"> S2 </span><span style="color:#f47067">@</span><span style="color:#adbac7"> V2</span></span>
<span class="line"><span style="color:#adbac7">    F </span><span style="color:#f47067">=</span><span style="color:#adbac7"> T2.T </span><span style="color:#f47067">@</span><span style="color:#adbac7"> F </span><span style="color:#f47067">@</span><span style="color:#adbac7"> T1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">return</span><span style="color:#adbac7"> F</span></span>
<span class="line"></span></code></pre><pre class="shiki github-light shiki-light"><code v-pre=""><span class="line"><span style="color:#d73a49">import</span><span style="color:#24292e"> numpy </span><span style="color:#d73a49">as</span><span style="color:#24292e"> np</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49">def</span><span style="color:#24292e"> </span><span style="color:#6f42c1">normalize</span><span style="color:#24292e">(pt: np.ndarray):</span></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#032f62">"""Normalizes the given set of points."""</span></span>
<span class="line"><span style="color:#24292e">    N </span><span style="color:#d73a49">=</span><span style="color:#24292e"> pt.shape[</span><span style="color:#005cc5">0</span><span style="color:#24292e">]</span></span>
<span class="line"><span style="color:#24292e">    mean </span><span style="color:#d73a49">=</span><span style="color:#24292e"> pt </span><span style="color:#d73a49">-</span><span style="color:#24292e"> np.mean(pt, </span><span style="color:#e36209">axis</span><span style="color:#d73a49">=</span><span style="color:#005cc5">0</span><span style="color:#24292e">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    scale </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.sum(np.square(pt)) </span><span style="color:#d73a49">/</span><span style="color:#24292e"> (</span><span style="color:#005cc5">2</span><span style="color:#24292e"> </span><span style="color:#d73a49">*</span><span style="color:#24292e"> N)</span></span>
<span class="line"><span style="color:#24292e">    scale </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.sqrt(</span><span style="color:#005cc5">1</span><span style="color:#24292e"> </span><span style="color:#d73a49">/</span><span style="color:#24292e"> scale)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">return</span><span style="color:#24292e"> scale </span><span style="color:#d73a49">*</span><span style="color:#24292e"> mean, scale</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49">def</span><span style="color:#24292e"> </span><span style="color:#6f42c1">compute_fundamental_mat</span><span style="color:#24292e">(pt1: np.ndarray, pt2: np.ndarray)-&gt; np.ndarray:</span></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#032f62">"""Computes the fundamental matrix F using SVD."""</span></span>
<span class="line"><span style="color:#24292e">    N </span><span style="color:#d73a49">=</span><span style="color:#24292e"> pt1.shape[</span><span style="color:#005cc5">0</span><span style="color:#24292e">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    norm_pt1, scale1 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> normalize(pt1)</span></span>
<span class="line"><span style="color:#24292e">    norm_pt2, scale2 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> normalize(pt2)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    T1 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.array([</span></span>
<span class="line"><span style="color:#24292e">        [scale1, </span><span style="color:#005cc5">0</span><span style="color:#24292e">, </span><span style="color:#d73a49">-</span><span style="color:#24292e"> scale1 </span><span style="color:#d73a49">*</span><span style="color:#24292e"> np.mean(pt1[:, </span><span style="color:#005cc5">0</span><span style="color:#24292e">])],</span></span>
<span class="line"><span style="color:#24292e">        [</span><span style="color:#005cc5">0</span><span style="color:#24292e">, scale1, </span><span style="color:#d73a49">-</span><span style="color:#24292e"> scale1 </span><span style="color:#d73a49">*</span><span style="color:#24292e"> np.mean(pt1[:, </span><span style="color:#005cc5">1</span><span style="color:#24292e">])],</span></span>
<span class="line"><span style="color:#24292e">        [</span><span style="color:#005cc5">0</span><span style="color:#24292e">, </span><span style="color:#005cc5">0</span><span style="color:#24292e">, </span><span style="color:#005cc5">1</span><span style="color:#24292e">]</span></span>
<span class="line"><span style="color:#24292e">    ])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    T2 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.array([</span></span>
<span class="line"><span style="color:#24292e">        [scale2, </span><span style="color:#005cc5">0</span><span style="color:#24292e">, </span><span style="color:#d73a49">-</span><span style="color:#24292e"> scale2 </span><span style="color:#d73a49">*</span><span style="color:#24292e"> np.mean(pt2[:, </span><span style="color:#005cc5">0</span><span style="color:#24292e">])],</span></span>
<span class="line"><span style="color:#24292e">        [</span><span style="color:#005cc5">0</span><span style="color:#24292e">, scale2, </span><span style="color:#d73a49">-</span><span style="color:#24292e"> scale2 </span><span style="color:#d73a49">*</span><span style="color:#24292e"> np.mean(pt2[:, </span><span style="color:#005cc5">1</span><span style="color:#24292e">])],</span></span>
<span class="line"><span style="color:#24292e">        [</span><span style="color:#005cc5">0</span><span style="color:#24292e">, </span><span style="color:#005cc5">0</span><span style="color:#24292e">, </span><span style="color:#005cc5">1</span><span style="color:#24292e">]</span></span>
<span class="line"><span style="color:#24292e">    ])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    A </span><span style="color:#d73a49">=</span><span style="color:#24292e"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">for</span><span style="color:#24292e"> i </span><span style="color:#d73a49">in</span><span style="color:#24292e"> </span><span style="color:#005cc5">range</span><span style="color:#24292e">(N):</span></span>
<span class="line"><span style="color:#24292e">        x1, y1 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> norm_pt1[i]</span></span>
<span class="line"><span style="color:#24292e">        x2, y2 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> norm_pt2[i]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        a </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.array([x2 </span><span style="color:#d73a49">*</span><span style="color:#24292e"> x1, x2 </span><span style="color:#d73a49">*</span><span style="color:#24292e"> y1, x2, y2 </span><span style="color:#d73a49">*</span><span style="color:#24292e"> x1, y2 </span><span style="color:#d73a49">*</span><span style="color:#24292e"> y1, y2, x1, y1, </span><span style="color:#005cc5">1</span><span style="color:#24292e">])</span></span>
<span class="line"><span style="color:#24292e">        A.append(a)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    A </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.array(A)  </span><span style="color:#6a737d"># (N, 9)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    U1, S1, V1 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.linalg.svd(A)</span></span>
<span class="line"><span style="color:#24292e">    F </span><span style="color:#d73a49">=</span><span style="color:#24292e"> V1[</span><span style="color:#d73a49">-</span><span style="color:#005cc5">1</span><span style="color:#24292e">,:].reshape(</span><span style="color:#005cc5">3</span><span style="color:#24292e">, </span><span style="color:#005cc5">3</span><span style="color:#24292e">)</span></span>
<span class="line"><span style="color:#24292e">    F </span><span style="color:#d73a49">/=</span><span style="color:#24292e"> F[</span><span style="color:#005cc5">2</span><span style="color:#24292e">, </span><span style="color:#005cc5">2</span><span style="color:#24292e">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    U2, S2, V2 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.linalg.svd(F)</span></span>
<span class="line"><span style="color:#24292e">    S2 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.diag(S2)</span></span>
<span class="line"><span style="color:#24292e">    S2[</span><span style="color:#d73a49">-</span><span style="color:#005cc5">1</span><span style="color:#24292e">] </span><span style="color:#d73a49">=</span><span style="color:#24292e"> </span><span style="color:#005cc5">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    F </span><span style="color:#d73a49">=</span><span style="color:#24292e"> U2 </span><span style="color:#d73a49">@</span><span style="color:#24292e"> S2 </span><span style="color:#d73a49">@</span><span style="color:#24292e"> V2</span></span>
<span class="line"><span style="color:#24292e">    F </span><span style="color:#d73a49">=</span><span style="color:#24292e"> T2.T </span><span style="color:#d73a49">@</span><span style="color:#24292e"> F </span><span style="color:#d73a49">@</span><span style="color:#24292e"> T1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">return</span><span style="color:#24292e"> F</span></span>
<span class="line"></span></code></pre></div><h3 id="ransac" tabindex="-1">RANSAC <a class="header-anchor" href="#ransac" aria-hidden="true">#</a></h3><p>Our feature detection and tracking algorithms are not perfect, leading to several erroneous correspondences (outliers). Therefore, RANSAC is used to remove these outliers.</p><p>RANSAC is an iterative algorithm terminating after a fixed number of iterations. At every iteration, it works in the following way:</p><ul><li>Picks 8 keypoint correspondences from <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0715em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8917em;vertical-align:-.2083em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0715em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2083em"><span></span></span></span></span></span></span></span></span></span></li><li>Computes <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.13889em">F</span></span></span></span> using Hartley’s 8-point algorithm mentioned above</li><li>Determines how many of all other keypoints are inliers</li></ul><p>Finally, the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.13889em">F</span></span></span></span> with the maximum number of inliers will be used.</p><div class="language-python"><span class="lang">python</span><pre class="shiki github-dark-dimmed shiki-dark"><code v-pre=""><span class="line"><span style="color:#f47067">def</span><span style="color:#adbac7"> </span><span style="color:#dcbdfb">compute_ransac_error</span><span style="color:#adbac7">(F: np.ndarray, pt1: np.ndarray, pt2: np.ndarray):</span></span>
<span class="line"><span style="color:#adbac7">    n </span><span style="color:#f47067">=</span><span style="color:#adbac7"> pt1.shape[</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    p1 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.hstack((pt1, np.ones((n, </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">))))</span></span>
<span class="line"><span style="color:#adbac7">    p2 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.hstack((pt2, np.ones((n, </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">))))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    e1 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> p1 </span><span style="color:#f47067">@</span><span style="color:#adbac7"> F.T</span></span>
<span class="line"><span style="color:#adbac7">    e2 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> p2 </span><span style="color:#f47067">@</span><span style="color:#adbac7"> F</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    error </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.sum(e2 </span><span style="color:#f47067">*</span><span style="color:#adbac7"> p1, </span><span style="color:#f69d50">axis</span><span style="color:#f47067">=</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">, </span><span style="color:#f69d50">keepdims</span><span style="color:#f47067">=</span><span style="color:#6cb6ff">True</span><span style="color:#adbac7">) </span><span style="color:#f47067">**</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">2</span><span style="color:#adbac7"> </span><span style="color:#f47067">/</span><span style="color:#adbac7"> np.sum(np.hstack((e1[:, :</span><span style="color:#f47067">-</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">], e2[:, :</span><span style="color:#f47067">-</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">])) </span><span style="color:#f47067">**</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">2</span><span style="color:#adbac7">, </span><span style="color:#f69d50">axis</span><span style="color:#f47067">=</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">, </span><span style="color:#f69d50">keepdims</span><span style="color:#f47067">=</span><span style="color:#6cb6ff">True</span><span style="color:#adbac7">)</span></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">return</span><span style="color:#adbac7"> error</span></span>
<span class="line"></span>
<span class="line"><span style="color:#f47067">def</span><span style="color:#adbac7"> </span><span style="color:#dcbdfb">find_fundamental_mat</span><span style="color:#adbac7">(</span></span>
<span class="line"><span style="color:#adbac7">    pt1: np.ndarray, pt2: np.ndarray, threshold: </span><span style="color:#6cb6ff">float</span><span style="color:#adbac7"> </span><span style="color:#f47067">=</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">0.05</span></span>
<span class="line"><span style="color:#adbac7">)-&gt; np.ndarray:</span></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#96d0ff">"""Estimates the fundamental matrix using RANSAC."""</span></span>
<span class="line"><span style="color:#adbac7">    max_inliers </span><span style="color:#f47067">=</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">0</span></span>
<span class="line"><span style="color:#adbac7">    best_F </span><span style="color:#f47067">=</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">None</span></span>
<span class="line"><span style="color:#adbac7">    confidence </span><span style="color:#f47067">=</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">0.99</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    N </span><span style="color:#f47067">=</span><span style="color:#adbac7"> sys.maxsize</span></span>
<span class="line"><span style="color:#adbac7">    count </span><span style="color:#f47067">=</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">while</span><span style="color:#adbac7"> N </span><span style="color:#f47067">&gt;</span><span style="color:#adbac7"> count:</span></span>
<span class="line"><span style="color:#adbac7">        x, y </span><span style="color:#f47067">=</span><span style="color:#adbac7"> sample_eight_points(pt1, pt2)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        F </span><span style="color:#f47067">=</span><span style="color:#adbac7"> compute_fundamental_mat(x, y)</span></span>
<span class="line"><span style="color:#adbac7">        error </span><span style="color:#f47067">=</span><span style="color:#adbac7"> compute_ransac_error(F, pt1, pt2)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        inliers </span><span style="color:#f47067">=</span><span style="color:#adbac7"> error </span><span style="color:#f47067">&lt;=</span><span style="color:#adbac7"> threshold</span></span>
<span class="line"><span style="color:#adbac7">        n_inliers </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.sum(inliers)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        </span><span style="color:#f47067">if</span><span style="color:#adbac7"> max_inliers </span><span style="color:#f47067">&lt;</span><span style="color:#adbac7"> np.sum(inliers):</span></span>
<span class="line"><span style="color:#adbac7">            max_inliers </span><span style="color:#f47067">=</span><span style="color:#adbac7"> n_inliers</span></span>
<span class="line"><span style="color:#adbac7">            best_F </span><span style="color:#f47067">=</span><span style="color:#adbac7"> F.copy()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        ratio </span><span style="color:#f47067">=</span><span style="color:#adbac7"> n_inliers </span><span style="color:#f47067">/</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">len</span><span style="color:#adbac7">(pt1)</span></span>
<span class="line"><span style="color:#adbac7">        </span><span style="color:#f47067">if</span><span style="color:#adbac7"> np.log(</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7"> </span><span style="color:#f47067">-</span><span style="color:#adbac7"> (ratio </span><span style="color:#f47067">**</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">8</span><span style="color:#adbac7">)) </span><span style="color:#f47067">==</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">:</span></span>
<span class="line"><span style="color:#adbac7">            </span><span style="color:#f47067">continue</span></span>
<span class="line"><span style="color:#adbac7">        N </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.log(</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7"> </span><span style="color:#f47067">-</span><span style="color:#adbac7"> confidence) </span><span style="color:#f47067">/</span><span style="color:#adbac7"> np.log(</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7"> </span><span style="color:#f47067">-</span><span style="color:#adbac7"> (ratio </span><span style="color:#f47067">**</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">8</span><span style="color:#adbac7">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        count </span><span style="color:#f47067">+=</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">return</span><span style="color:#adbac7"> best_F</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">F </span><span style="color:#f47067">=</span><span style="color:#adbac7"> find_fundamental_mat(kp1, kp2, </span><span style="color:#6cb6ff">0.05</span><span style="color:#adbac7">)</span></span>
<span class="line"></span></code></pre><pre class="shiki github-light shiki-light"><code v-pre=""><span class="line"><span style="color:#d73a49">def</span><span style="color:#24292e"> </span><span style="color:#6f42c1">compute_ransac_error</span><span style="color:#24292e">(F: np.ndarray, pt1: np.ndarray, pt2: np.ndarray):</span></span>
<span class="line"><span style="color:#24292e">    n </span><span style="color:#d73a49">=</span><span style="color:#24292e"> pt1.shape[</span><span style="color:#005cc5">0</span><span style="color:#24292e">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    p1 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.hstack((pt1, np.ones((n, </span><span style="color:#005cc5">1</span><span style="color:#24292e">))))</span></span>
<span class="line"><span style="color:#24292e">    p2 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.hstack((pt2, np.ones((n, </span><span style="color:#005cc5">1</span><span style="color:#24292e">))))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    e1 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> p1 </span><span style="color:#d73a49">@</span><span style="color:#24292e"> F.T</span></span>
<span class="line"><span style="color:#24292e">    e2 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> p2 </span><span style="color:#d73a49">@</span><span style="color:#24292e"> F</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    error </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.sum(e2 </span><span style="color:#d73a49">*</span><span style="color:#24292e"> p1, </span><span style="color:#e36209">axis</span><span style="color:#d73a49">=</span><span style="color:#005cc5">1</span><span style="color:#24292e">, </span><span style="color:#e36209">keepdims</span><span style="color:#d73a49">=</span><span style="color:#005cc5">True</span><span style="color:#24292e">) </span><span style="color:#d73a49">**</span><span style="color:#24292e"> </span><span style="color:#005cc5">2</span><span style="color:#24292e"> </span><span style="color:#d73a49">/</span><span style="color:#24292e"> np.sum(np.hstack((e1[:, :</span><span style="color:#d73a49">-</span><span style="color:#005cc5">1</span><span style="color:#24292e">], e2[:, :</span><span style="color:#d73a49">-</span><span style="color:#005cc5">1</span><span style="color:#24292e">])) </span><span style="color:#d73a49">**</span><span style="color:#24292e"> </span><span style="color:#005cc5">2</span><span style="color:#24292e">, </span><span style="color:#e36209">axis</span><span style="color:#d73a49">=</span><span style="color:#005cc5">1</span><span style="color:#24292e">, </span><span style="color:#e36209">keepdims</span><span style="color:#d73a49">=</span><span style="color:#005cc5">True</span><span style="color:#24292e">)</span></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">return</span><span style="color:#24292e"> error</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49">def</span><span style="color:#24292e"> </span><span style="color:#6f42c1">find_fundamental_mat</span><span style="color:#24292e">(</span></span>
<span class="line"><span style="color:#24292e">    pt1: np.ndarray, pt2: np.ndarray, threshold: </span><span style="color:#005cc5">float</span><span style="color:#24292e"> </span><span style="color:#d73a49">=</span><span style="color:#24292e"> </span><span style="color:#005cc5">0.05</span></span>
<span class="line"><span style="color:#24292e">)-&gt; np.ndarray:</span></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#032f62">"""Estimates the fundamental matrix using RANSAC."""</span></span>
<span class="line"><span style="color:#24292e">    max_inliers </span><span style="color:#d73a49">=</span><span style="color:#24292e"> </span><span style="color:#005cc5">0</span></span>
<span class="line"><span style="color:#24292e">    best_F </span><span style="color:#d73a49">=</span><span style="color:#24292e"> </span><span style="color:#005cc5">None</span></span>
<span class="line"><span style="color:#24292e">    confidence </span><span style="color:#d73a49">=</span><span style="color:#24292e"> </span><span style="color:#005cc5">0.99</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    N </span><span style="color:#d73a49">=</span><span style="color:#24292e"> sys.maxsize</span></span>
<span class="line"><span style="color:#24292e">    count </span><span style="color:#d73a49">=</span><span style="color:#24292e"> </span><span style="color:#005cc5">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">while</span><span style="color:#24292e"> N </span><span style="color:#d73a49">&gt;</span><span style="color:#24292e"> count:</span></span>
<span class="line"><span style="color:#24292e">        x, y </span><span style="color:#d73a49">=</span><span style="color:#24292e"> sample_eight_points(pt1, pt2)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        F </span><span style="color:#d73a49">=</span><span style="color:#24292e"> compute_fundamental_mat(x, y)</span></span>
<span class="line"><span style="color:#24292e">        error </span><span style="color:#d73a49">=</span><span style="color:#24292e"> compute_ransac_error(F, pt1, pt2)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        inliers </span><span style="color:#d73a49">=</span><span style="color:#24292e"> error </span><span style="color:#d73a49">&lt;=</span><span style="color:#24292e"> threshold</span></span>
<span class="line"><span style="color:#24292e">        n_inliers </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.sum(inliers)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        </span><span style="color:#d73a49">if</span><span style="color:#24292e"> max_inliers </span><span style="color:#d73a49">&lt;</span><span style="color:#24292e"> np.sum(inliers):</span></span>
<span class="line"><span style="color:#24292e">            max_inliers </span><span style="color:#d73a49">=</span><span style="color:#24292e"> n_inliers</span></span>
<span class="line"><span style="color:#24292e">            best_F </span><span style="color:#d73a49">=</span><span style="color:#24292e"> F.copy()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        ratio </span><span style="color:#d73a49">=</span><span style="color:#24292e"> n_inliers </span><span style="color:#d73a49">/</span><span style="color:#24292e"> </span><span style="color:#005cc5">len</span><span style="color:#24292e">(pt1)</span></span>
<span class="line"><span style="color:#24292e">        </span><span style="color:#d73a49">if</span><span style="color:#24292e"> np.log(</span><span style="color:#005cc5">1</span><span style="color:#24292e"> </span><span style="color:#d73a49">-</span><span style="color:#24292e"> (ratio </span><span style="color:#d73a49">**</span><span style="color:#24292e"> </span><span style="color:#005cc5">8</span><span style="color:#24292e">)) </span><span style="color:#d73a49">==</span><span style="color:#24292e"> </span><span style="color:#005cc5">0</span><span style="color:#24292e">:</span></span>
<span class="line"><span style="color:#24292e">            </span><span style="color:#d73a49">continue</span></span>
<span class="line"><span style="color:#24292e">        N </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.log(</span><span style="color:#005cc5">1</span><span style="color:#24292e"> </span><span style="color:#d73a49">-</span><span style="color:#24292e"> confidence) </span><span style="color:#d73a49">/</span><span style="color:#24292e"> np.log(</span><span style="color:#005cc5">1</span><span style="color:#24292e"> </span><span style="color:#d73a49">-</span><span style="color:#24292e"> (ratio </span><span style="color:#d73a49">**</span><span style="color:#24292e"> </span><span style="color:#005cc5">8</span><span style="color:#24292e">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        count </span><span style="color:#d73a49">+=</span><span style="color:#24292e"> </span><span style="color:#005cc5">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">return</span><span style="color:#24292e"> best_F</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">F </span><span style="color:#d73a49">=</span><span style="color:#24292e"> find_fundamental_mat(kp1, kp2, </span><span style="color:#005cc5">0.05</span><span style="color:#24292e">)</span></span>
<span class="line"></span></code></pre></div><p>Then the problem is how to pick 8 keypoint correspondences (<code>sample_eight_points</code>). While Hartley’s 8-point algorithm samples them randomly, to make the algorithm more robust to outliers, we can use the way mentioned <a href="https://www.crcv.ucf.edu/wp-content/uploads/2019/03/Lecture-13-FundamentalMatrix.pdf" target="_blank" rel="noopener noreferrer">here</a> (page 39) instead: uniformly dividing a frame into an <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7278em;vertical-align:-.0833em"></span><span class="mord">8</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6444em"></span><span class="mord">8</span></span></span></span> grid, then randomly selecting 8 grid cells and picking one pair of corresponding keypoints from each grid cell.</p><h2 id="essential-matrix" tabindex="-1">Essential Matrix <a class="header-anchor" href="#essential-matrix" aria-hidden="true">#</a></h2><p>Essential matrix <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span></span></span></span> is another <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7278em;vertical-align:-.0833em"></span><span class="mord">3</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6444em"></span><span class="mord">3</span></span></span></span> matrix. But unlike <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.13889em">F</span></span></span></span>, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span></span></span></span> assumes that the cameras obey the pinhole model. More specifically, given the camera calibration matrix <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.07153em">K</span></span></span></span>, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8413em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8413em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.13889em">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:.13889em">F</span><span class="mord mathnormal" style="margin-right:.07153em">K</span></span></span></span>, which also can be solved using SVD.</p><div class="language-python"><span class="lang">python</span><pre class="shiki github-dark-dimmed has-highlighted-lines shiki-dark"><code v-pre=""><span class="line"><span style="color:#f47067">def</span><span style="color:#adbac7"> </span><span style="color:#dcbdfb">find_essential_mat</span><span style="color:#adbac7">(K: np.ndarray, F: np.ndarray)-&gt; np.ndarray:</span></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#96d0ff">"""Estimates the essential matrix."""</span></span>
<span class="line"><span style="color:#adbac7">    E </span><span style="color:#f47067">=</span><span style="color:#adbac7"> K.T </span><span style="color:#f47067">@</span><span style="color:#adbac7"> F </span><span style="color:#f47067">@</span><span style="color:#adbac7"> K</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    U, S, V </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.linalg.svd(E)</span></span>
<span class="line highlighted"><span style="color:#adbac7">    S </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.asarray([</span></span>
<span class="line"><span style="color:#adbac7">        [</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">],</span></span>
<span class="line"><span style="color:#adbac7">        [</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">],</span></span>
<span class="line"><span style="color:#adbac7">        [</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">]</span></span>
<span class="line"><span style="color:#adbac7">    ])</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#adbac7">    E </span><span style="color:#f47067">=</span><span style="color:#adbac7"> U </span><span style="color:#f47067">@</span><span style="color:#adbac7"> S </span><span style="color:#f47067">@</span><span style="color:#adbac7"> V</span></span>
<span class="line"><span style="color:#adbac7">    E </span><span style="color:#f47067">=</span><span style="color:#adbac7"> E </span><span style="color:#f47067">/</span><span style="color:#adbac7"> np.linalg.norm(E)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">return</span><span style="color:#adbac7"> E</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">E </span><span style="color:#f47067">=</span><span style="color:#adbac7"> find_essential_mat(K, F)</span></span>
<span class="line"></span></code></pre><pre class="shiki github-light has-highlighted-lines shiki-light"><code v-pre=""><span class="line"><span style="color:#d73a49">def</span><span style="color:#24292e"> </span><span style="color:#6f42c1">find_essential_mat</span><span style="color:#24292e">(K: np.ndarray, F: np.ndarray)-&gt; np.ndarray:</span></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#032f62">"""Estimates the essential matrix."""</span></span>
<span class="line"><span style="color:#24292e">    E </span><span style="color:#d73a49">=</span><span style="color:#24292e"> K.T </span><span style="color:#d73a49">@</span><span style="color:#24292e"> F </span><span style="color:#d73a49">@</span><span style="color:#24292e"> K</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    U, S, V </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.linalg.svd(E)</span></span>
<span class="line highlighted"><span style="color:#24292e">    S </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.asarray([</span></span>
<span class="line"><span style="color:#24292e">        [</span><span style="color:#005cc5">1</span><span style="color:#24292e">, </span><span style="color:#005cc5">0</span><span style="color:#24292e">, </span><span style="color:#005cc5">0</span><span style="color:#24292e">],</span></span>
<span class="line"><span style="color:#24292e">        [</span><span style="color:#005cc5">0</span><span style="color:#24292e">, </span><span style="color:#005cc5">1</span><span style="color:#24292e">, </span><span style="color:#005cc5">0</span><span style="color:#24292e">],</span></span>
<span class="line"><span style="color:#24292e">        [</span><span style="color:#005cc5">0</span><span style="color:#24292e">, </span><span style="color:#005cc5">0</span><span style="color:#24292e">, </span><span style="color:#005cc5">0</span><span style="color:#24292e">]</span></span>
<span class="line"><span style="color:#24292e">    ])</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#24292e">    E </span><span style="color:#d73a49">=</span><span style="color:#24292e"> U </span><span style="color:#d73a49">@</span><span style="color:#24292e"> S </span><span style="color:#d73a49">@</span><span style="color:#24292e"> V</span></span>
<span class="line"><span style="color:#24292e">    E </span><span style="color:#d73a49">=</span><span style="color:#24292e"> E </span><span style="color:#d73a49">/</span><span style="color:#24292e"> np.linalg.norm(E)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">return</span><span style="color:#24292e"> E</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">E </span><span style="color:#d73a49">=</span><span style="color:#24292e"> find_essential_mat(K, F)</span></span>
<span class="line"></span></code></pre></div><p>Note that the singular values of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span></span></span></span> are not necessarily <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span> due to the noise in K. Thus <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span></span></span></span> should be reconstructed with <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span> singular values:</p><p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em"></span><span class="mord mathnormal" style="margin-right:.10903em">U</span><span class="mspace" style="margin-right:.1667em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:.667em;height:3.6em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.05em"><span class="pstrut" style="height:5.6em"></span><span style="width:.667em;height:3.6em"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.22222em">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8991em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span></span></span></span></span></p><hr><p>Now we have successfully estimated the essential matrix <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span></span></span></span> manually, looks cool! However, this can also be done with the help of OpenCV, and all you need is one line:</p><div class="language-python"><span class="lang">python</span><pre class="shiki github-dark-dimmed shiki-dark"><code v-pre=""><span class="line"><span style="color:#adbac7">E, mask </span><span style="color:#f47067">=</span><span style="color:#adbac7"> cv2.findEssentialMat(kp2, kp1, K, cv2.</span><span style="color:#6cb6ff">RANSAC</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">0.999</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">0.3</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">None</span><span style="color:#adbac7">)</span></span>
<span class="line"></span></code></pre><pre class="shiki github-light shiki-light"><code v-pre=""><span class="line"><span style="color:#24292e">E, mask </span><span style="color:#d73a49">=</span><span style="color:#24292e"> cv2.findEssentialMat(kp2, kp1, K, cv2.</span><span style="color:#005cc5">RANSAC</span><span style="color:#24292e">, </span><span style="color:#005cc5">0.999</span><span style="color:#24292e">, </span><span style="color:#005cc5">0.3</span><span style="color:#24292e">, </span><span style="color:#005cc5">None</span><span style="color:#24292e">)</span></span>
<span class="line"></span></code></pre></div><p>OpenCV uses <a href="https://www-users.cse.umn.edu/~hspark/CSci5980/nister.pdf" target="_blank" rel="noopener noreferrer">Nistér’s 5-point algorithm</a>, a more recent approach that is shown to give better results, to compute <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span></span></span></span>. It requires the minimum number of keypoints possible since <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span></span></span></span> has only 5 degrees of freedom (<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.13889em">F</span></span></span></span> has 7 degrees of freedom, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span></span></span></span> has only 5 as it takes camera parameters into account).</p><h2 id="camera-pose" tabindex="-1">Camera Pose <a class="header-anchor" href="#camera-pose" aria-hidden="true">#</a></h2><p>Just follow <a href="https://cmsc426.github.io/sfm/#essential" target="_blank" rel="noopener noreferrer">here</a> to recover the camera rotation matrix <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> and translation vector <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7651em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> from <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span></span></span></span>.</p><div class="language-python"><span class="lang">python</span><pre class="shiki github-dark-dimmed shiki-dark"><code v-pre=""><span class="line"><span style="color:#f47067">def</span><span style="color:#adbac7"> </span><span style="color:#dcbdfb">linear_triangulation</span><span style="color:#adbac7">(</span></span>
<span class="line"><span style="color:#adbac7">    T1: np.ndarray,</span></span>
<span class="line"><span style="color:#adbac7">    R1: np.ndarray,</span></span>
<span class="line"><span style="color:#adbac7">    T2: np.ndarray,</span></span>
<span class="line"><span style="color:#adbac7">    R2: np.ndarray,</span></span>
<span class="line"><span style="color:#adbac7">    pt1: np.ndarray,</span></span>
<span class="line"><span style="color:#adbac7">    pt2: np.ndarray,</span></span>
<span class="line"><span style="color:#adbac7">    K: np.ndarray,</span></span>
<span class="line"><span style="color:#adbac7">)-&gt; np.ndarray:</span></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#96d0ff">"""Linear triangulation."""</span></span>
<span class="line"><span style="color:#adbac7">    P1 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> K </span><span style="color:#f47067">@</span><span style="color:#adbac7"> np.hstack((R1, </span><span style="color:#f47067">-</span><span style="color:#adbac7">R1 </span><span style="color:#f47067">@</span><span style="color:#adbac7"> T1))</span></span>
<span class="line"><span style="color:#adbac7">    P2 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> K </span><span style="color:#f47067">@</span><span style="color:#adbac7"> np.hstack((R2, </span><span style="color:#f47067">-</span><span style="color:#adbac7">R2 </span><span style="color:#f47067">@</span><span style="color:#adbac7"> T2))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    X </span><span style="color:#f47067">=</span><span style="color:#adbac7"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">for</span><span style="color:#adbac7"> i </span><span style="color:#f47067">in</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">range</span><span style="color:#adbac7">(</span><span style="color:#6cb6ff">len</span><span style="color:#adbac7">(pt1)):</span></span>
<span class="line"><span style="color:#adbac7">        x1, x2 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> pt1[i], pt2[i]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        A1 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> x1[</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">] </span><span style="color:#f47067">*</span><span style="color:#adbac7"> P1[</span><span style="color:#6cb6ff">2</span><span style="color:#adbac7">, :] </span><span style="color:#f47067">-</span><span style="color:#adbac7"> P1[</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, :]</span></span>
<span class="line"><span style="color:#adbac7">        A2 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> x1[</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">] </span><span style="color:#f47067">*</span><span style="color:#adbac7"> P1[</span><span style="color:#6cb6ff">2</span><span style="color:#adbac7">, :] </span><span style="color:#f47067">-</span><span style="color:#adbac7"> P1[</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">, :]</span></span>
<span class="line"><span style="color:#adbac7">        A3 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> x2[</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">] </span><span style="color:#f47067">*</span><span style="color:#adbac7"> P2[</span><span style="color:#6cb6ff">2</span><span style="color:#adbac7">, :] </span><span style="color:#f47067">-</span><span style="color:#adbac7"> P2[</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, :]</span></span>
<span class="line"><span style="color:#adbac7">        A4 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> x2[</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">] </span><span style="color:#f47067">*</span><span style="color:#adbac7"> P2[</span><span style="color:#6cb6ff">2</span><span style="color:#adbac7">, :] </span><span style="color:#f47067">-</span><span style="color:#adbac7"> P2[</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">, :]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        A </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.asarray([A1, A2, A3, A4])</span></span>
<span class="line"><span style="color:#adbac7">        U, S, V </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.linalg.svd(A)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        V </span><span style="color:#f47067">=</span><span style="color:#adbac7"> V[</span><span style="color:#6cb6ff">3</span><span style="color:#adbac7">]</span></span>
<span class="line"><span style="color:#adbac7">        V </span><span style="color:#f47067">=</span><span style="color:#adbac7"> V </span><span style="color:#f47067">/</span><span style="color:#adbac7"> V[</span><span style="color:#f47067">-</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        X.append(V)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">return</span><span style="color:#adbac7"> np.asarray(X)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#f47067">def</span><span style="color:#adbac7"> </span><span style="color:#dcbdfb">recover_pose</span><span style="color:#adbac7">(E: np.ndarray, pt1, pt2, K: np.ndarray):</span></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#96d0ff">"""Recovers the camera pose."""</span></span>
<span class="line"><span style="color:#adbac7">    W </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.asarray([</span></span>
<span class="line"><span style="color:#adbac7">        [</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, </span><span style="color:#f47067">-</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">],</span></span>
<span class="line"><span style="color:#adbac7">        [</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">,  </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">],</span></span>
<span class="line"><span style="color:#adbac7">        [</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">,  </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">]</span></span>
<span class="line"><span style="color:#adbac7">    ])</span></span>
<span class="line"><span style="color:#adbac7">    U, S, V </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.linalg.svd(E)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    poses </span><span style="color:#f47067">=</span><span style="color:#adbac7"> {</span></span>
<span class="line"><span style="color:#adbac7">        </span><span style="color:#96d0ff">"T1"</span><span style="color:#adbac7">:  U[:, </span><span style="color:#6cb6ff">2</span><span style="color:#adbac7">].reshape(</span><span style="color:#6cb6ff">3</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">),</span></span>
<span class="line"><span style="color:#adbac7">        </span><span style="color:#96d0ff">"T2"</span><span style="color:#adbac7">: </span><span style="color:#f47067">-</span><span style="color:#adbac7">U[:, </span><span style="color:#6cb6ff">2</span><span style="color:#adbac7">].reshape(</span><span style="color:#6cb6ff">3</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">),</span></span>
<span class="line"><span style="color:#adbac7">        </span><span style="color:#96d0ff">"T3"</span><span style="color:#adbac7">:  U[:, </span><span style="color:#6cb6ff">2</span><span style="color:#adbac7">].reshape(</span><span style="color:#6cb6ff">3</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">),</span></span>
<span class="line"><span style="color:#adbac7">        </span><span style="color:#96d0ff">"T4"</span><span style="color:#adbac7">: </span><span style="color:#f47067">-</span><span style="color:#adbac7">U[:, </span><span style="color:#6cb6ff">2</span><span style="color:#adbac7">].reshape(</span><span style="color:#6cb6ff">3</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">),</span></span>
<span class="line"><span style="color:#adbac7">        </span><span style="color:#96d0ff">"R1"</span><span style="color:#adbac7">:  U </span><span style="color:#f47067">@</span><span style="color:#adbac7"> W   </span><span style="color:#f47067">@</span><span style="color:#adbac7"> V,</span></span>
<span class="line"><span style="color:#adbac7">        </span><span style="color:#96d0ff">"R2"</span><span style="color:#adbac7">:  U </span><span style="color:#f47067">@</span><span style="color:#adbac7"> W   </span><span style="color:#f47067">@</span><span style="color:#adbac7"> V,</span></span>
<span class="line"><span style="color:#adbac7">        </span><span style="color:#96d0ff">"R3"</span><span style="color:#adbac7">:  U </span><span style="color:#f47067">@</span><span style="color:#adbac7"> W.T </span><span style="color:#f47067">@</span><span style="color:#adbac7"> V,</span></span>
<span class="line"><span style="color:#adbac7">        </span><span style="color:#96d0ff">"R4"</span><span style="color:#adbac7">:  U </span><span style="color:#f47067">@</span><span style="color:#adbac7"> W.T </span><span style="color:#f47067">@</span><span style="color:#adbac7"> V</span></span>
<span class="line"><span style="color:#adbac7">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">for</span><span style="color:#adbac7"> i </span><span style="color:#f47067">in</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">range</span><span style="color:#adbac7">(</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">5</span><span style="color:#adbac7">):</span></span>
<span class="line"><span style="color:#adbac7">        T, R </span><span style="color:#f47067">=</span><span style="color:#adbac7"> poses[</span><span style="color:#96d0ff">"T"</span><span style="color:#adbac7"> </span><span style="color:#f47067">+</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">str</span><span style="color:#adbac7">(i)], poses[</span><span style="color:#96d0ff">"R"</span><span style="color:#adbac7"> </span><span style="color:#f47067">+</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">str</span><span style="color:#adbac7">(i)]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        </span><span style="color:#f47067">if</span><span style="color:#adbac7"> np.linalg.det(R) </span><span style="color:#f47067">&lt;</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">:</span></span>
<span class="line"><span style="color:#adbac7">            T </span><span style="color:#f47067">=</span><span style="color:#adbac7"> </span><span style="color:#f47067">-</span><span style="color:#adbac7">T</span></span>
<span class="line"><span style="color:#adbac7">            R </span><span style="color:#f47067">=</span><span style="color:#adbac7"> </span><span style="color:#f47067">-</span><span style="color:#adbac7">R</span></span>
<span class="line"><span style="color:#adbac7">            poses[</span><span style="color:#96d0ff">"T"</span><span style="color:#adbac7"> </span><span style="color:#f47067">+</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">str</span><span style="color:#adbac7">(i)], poses[</span><span style="color:#96d0ff">"R"</span><span style="color:#adbac7"> </span><span style="color:#f47067">+</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">str</span><span style="color:#adbac7">(i)] </span><span style="color:#f47067">=</span><span style="color:#adbac7"> T, R</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        I </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.identity(</span><span style="color:#6cb6ff">3</span><span style="color:#adbac7">)</span></span>
<span class="line"><span style="color:#adbac7">        M </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.hstack((I, T.reshape(</span><span style="color:#6cb6ff">3</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">)))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        poses[</span><span style="color:#96d0ff">"P"</span><span style="color:#adbac7"> </span><span style="color:#f47067">+</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">str</span><span style="color:#adbac7">(i)] </span><span style="color:#f47067">=</span><span style="color:#adbac7"> K </span><span style="color:#f47067">@</span><span style="color:#adbac7"> R </span><span style="color:#f47067">@</span><span style="color:#adbac7"> M</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    max_Z, rt_idx </span><span style="color:#f47067">=</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">for</span><span style="color:#adbac7"> i </span><span style="color:#f47067">in</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">range</span><span style="color:#adbac7">(</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">5</span><span style="color:#adbac7">):</span></span>
<span class="line"><span style="color:#adbac7">        T1, R1 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> poses[</span><span style="color:#96d0ff">"T"</span><span style="color:#adbac7"> </span><span style="color:#f47067">+</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">str</span><span style="color:#adbac7">(i)], poses[</span><span style="color:#96d0ff">"R"</span><span style="color:#adbac7"> </span><span style="color:#f47067">+</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">str</span><span style="color:#adbac7">(i)]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        </span><span style="color:#768390"># ---------------------</span></span>
<span class="line"><span style="color:#adbac7">        T2, R2 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.asarray([[</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">],[</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">],[</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">]]), np.identity(</span><span style="color:#6cb6ff">3</span><span style="color:#adbac7">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        X </span><span style="color:#f47067">=</span><span style="color:#adbac7"> linear_triangulation(T2, R2, T1, R1, pt1, pt2, K)</span></span>
<span class="line"><span style="color:#adbac7">        Z </span><span style="color:#f47067">=</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        </span><span style="color:#f47067">for</span><span style="color:#adbac7"> j </span><span style="color:#f47067">in</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">range</span><span style="color:#adbac7">(X.shape[</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">]):</span></span>
<span class="line"><span style="color:#adbac7">            x </span><span style="color:#f47067">=</span><span style="color:#adbac7"> X[j, :].reshape(</span><span style="color:#f47067">-</span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">)</span></span>
<span class="line"><span style="color:#adbac7">            </span><span style="color:#f47067">if</span><span style="color:#adbac7"> R1[</span><span style="color:#6cb6ff">2</span><span style="color:#adbac7">] </span><span style="color:#f47067">@</span><span style="color:#adbac7"> np.subtract(x[</span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">:</span><span style="color:#6cb6ff">3</span><span style="color:#adbac7">], T1) </span><span style="color:#f47067">&gt;</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7"> </span><span style="color:#f47067">and</span><span style="color:#adbac7"> x[</span><span style="color:#6cb6ff">2</span><span style="color:#adbac7">] </span><span style="color:#f47067">&gt;</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">:</span></span>
<span class="line"><span style="color:#adbac7">                Z </span><span style="color:#f47067">+=</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">1</span></span>
<span class="line"><span style="color:#adbac7">        </span><span style="color:#768390"># ---------------------</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">        </span><span style="color:#f47067">if</span><span style="color:#adbac7"> max_Z </span><span style="color:#f47067">&lt;</span><span style="color:#adbac7"> Z:</span></span>
<span class="line"><span style="color:#adbac7">            max_Z, rt_idx </span><span style="color:#f47067">=</span><span style="color:#adbac7"> Z, </span><span style="color:#6cb6ff">str</span><span style="color:#adbac7">(i)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    cur_T, cur_R </span><span style="color:#f47067">=</span><span style="color:#adbac7"> poses[</span><span style="color:#96d0ff">"T"</span><span style="color:#adbac7"> </span><span style="color:#f47067">+</span><span style="color:#adbac7"> rt_idx], poses[</span><span style="color:#96d0ff">"R"</span><span style="color:#adbac7"> </span><span style="color:#f47067">+</span><span style="color:#adbac7"> rt_idx]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">if</span><span style="color:#adbac7"> cur_T[</span><span style="color:#6cb6ff">2</span><span style="color:#adbac7">] </span><span style="color:#f47067">&lt;</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">0</span><span style="color:#adbac7">:</span></span>
<span class="line"><span style="color:#adbac7">        cur_T </span><span style="color:#f47067">=</span><span style="color:#adbac7"> </span><span style="color:#f47067">-</span><span style="color:#adbac7">cur_T</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">    </span><span style="color:#f47067">return</span><span style="color:#adbac7"> cur_T, cur_R</span></span>
<span class="line"></span>
<span class="line"><span style="color:#adbac7">cur_T, cur_R </span><span style="color:#f47067">=</span><span style="color:#adbac7"> recover_pose(E, kp1, kp2, K)</span></span>
<span class="line"></span></code></pre><pre class="shiki github-light shiki-light"><code v-pre=""><span class="line"><span style="color:#d73a49">def</span><span style="color:#24292e"> </span><span style="color:#6f42c1">linear_triangulation</span><span style="color:#24292e">(</span></span>
<span class="line"><span style="color:#24292e">    T1: np.ndarray,</span></span>
<span class="line"><span style="color:#24292e">    R1: np.ndarray,</span></span>
<span class="line"><span style="color:#24292e">    T2: np.ndarray,</span></span>
<span class="line"><span style="color:#24292e">    R2: np.ndarray,</span></span>
<span class="line"><span style="color:#24292e">    pt1: np.ndarray,</span></span>
<span class="line"><span style="color:#24292e">    pt2: np.ndarray,</span></span>
<span class="line"><span style="color:#24292e">    K: np.ndarray,</span></span>
<span class="line"><span style="color:#24292e">)-&gt; np.ndarray:</span></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#032f62">"""Linear triangulation."""</span></span>
<span class="line"><span style="color:#24292e">    P1 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> K </span><span style="color:#d73a49">@</span><span style="color:#24292e"> np.hstack((R1, </span><span style="color:#d73a49">-</span><span style="color:#24292e">R1 </span><span style="color:#d73a49">@</span><span style="color:#24292e"> T1))</span></span>
<span class="line"><span style="color:#24292e">    P2 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> K </span><span style="color:#d73a49">@</span><span style="color:#24292e"> np.hstack((R2, </span><span style="color:#d73a49">-</span><span style="color:#24292e">R2 </span><span style="color:#d73a49">@</span><span style="color:#24292e"> T2))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    X </span><span style="color:#d73a49">=</span><span style="color:#24292e"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">for</span><span style="color:#24292e"> i </span><span style="color:#d73a49">in</span><span style="color:#24292e"> </span><span style="color:#005cc5">range</span><span style="color:#24292e">(</span><span style="color:#005cc5">len</span><span style="color:#24292e">(pt1)):</span></span>
<span class="line"><span style="color:#24292e">        x1, x2 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> pt1[i], pt2[i]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        A1 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> x1[</span><span style="color:#005cc5">0</span><span style="color:#24292e">] </span><span style="color:#d73a49">*</span><span style="color:#24292e"> P1[</span><span style="color:#005cc5">2</span><span style="color:#24292e">, :] </span><span style="color:#d73a49">-</span><span style="color:#24292e"> P1[</span><span style="color:#005cc5">0</span><span style="color:#24292e">, :]</span></span>
<span class="line"><span style="color:#24292e">        A2 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> x1[</span><span style="color:#005cc5">1</span><span style="color:#24292e">] </span><span style="color:#d73a49">*</span><span style="color:#24292e"> P1[</span><span style="color:#005cc5">2</span><span style="color:#24292e">, :] </span><span style="color:#d73a49">-</span><span style="color:#24292e"> P1[</span><span style="color:#005cc5">1</span><span style="color:#24292e">, :]</span></span>
<span class="line"><span style="color:#24292e">        A3 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> x2[</span><span style="color:#005cc5">0</span><span style="color:#24292e">] </span><span style="color:#d73a49">*</span><span style="color:#24292e"> P2[</span><span style="color:#005cc5">2</span><span style="color:#24292e">, :] </span><span style="color:#d73a49">-</span><span style="color:#24292e"> P2[</span><span style="color:#005cc5">0</span><span style="color:#24292e">, :]</span></span>
<span class="line"><span style="color:#24292e">        A4 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> x2[</span><span style="color:#005cc5">1</span><span style="color:#24292e">] </span><span style="color:#d73a49">*</span><span style="color:#24292e"> P2[</span><span style="color:#005cc5">2</span><span style="color:#24292e">, :] </span><span style="color:#d73a49">-</span><span style="color:#24292e"> P2[</span><span style="color:#005cc5">1</span><span style="color:#24292e">, :]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        A </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.asarray([A1, A2, A3, A4])</span></span>
<span class="line"><span style="color:#24292e">        U, S, V </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.linalg.svd(A)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        V </span><span style="color:#d73a49">=</span><span style="color:#24292e"> V[</span><span style="color:#005cc5">3</span><span style="color:#24292e">]</span></span>
<span class="line"><span style="color:#24292e">        V </span><span style="color:#d73a49">=</span><span style="color:#24292e"> V </span><span style="color:#d73a49">/</span><span style="color:#24292e"> V[</span><span style="color:#d73a49">-</span><span style="color:#005cc5">1</span><span style="color:#24292e">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        X.append(V)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">return</span><span style="color:#24292e"> np.asarray(X)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49">def</span><span style="color:#24292e"> </span><span style="color:#6f42c1">recover_pose</span><span style="color:#24292e">(E: np.ndarray, pt1, pt2, K: np.ndarray):</span></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#032f62">"""Recovers the camera pose."""</span></span>
<span class="line"><span style="color:#24292e">    W </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.asarray([</span></span>
<span class="line"><span style="color:#24292e">        [</span><span style="color:#005cc5">0</span><span style="color:#24292e">, </span><span style="color:#d73a49">-</span><span style="color:#005cc5">1</span><span style="color:#24292e">, </span><span style="color:#005cc5">0</span><span style="color:#24292e">],</span></span>
<span class="line"><span style="color:#24292e">        [</span><span style="color:#005cc5">1</span><span style="color:#24292e">,  </span><span style="color:#005cc5">0</span><span style="color:#24292e">, </span><span style="color:#005cc5">0</span><span style="color:#24292e">],</span></span>
<span class="line"><span style="color:#24292e">        [</span><span style="color:#005cc5">0</span><span style="color:#24292e">,  </span><span style="color:#005cc5">0</span><span style="color:#24292e">, </span><span style="color:#005cc5">1</span><span style="color:#24292e">]</span></span>
<span class="line"><span style="color:#24292e">    ])</span></span>
<span class="line"><span style="color:#24292e">    U, S, V </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.linalg.svd(E)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    poses </span><span style="color:#d73a49">=</span><span style="color:#24292e"> {</span></span>
<span class="line"><span style="color:#24292e">        </span><span style="color:#032f62">"T1"</span><span style="color:#24292e">:  U[:, </span><span style="color:#005cc5">2</span><span style="color:#24292e">].reshape(</span><span style="color:#005cc5">3</span><span style="color:#24292e">, </span><span style="color:#005cc5">1</span><span style="color:#24292e">),</span></span>
<span class="line"><span style="color:#24292e">        </span><span style="color:#032f62">"T2"</span><span style="color:#24292e">: </span><span style="color:#d73a49">-</span><span style="color:#24292e">U[:, </span><span style="color:#005cc5">2</span><span style="color:#24292e">].reshape(</span><span style="color:#005cc5">3</span><span style="color:#24292e">, </span><span style="color:#005cc5">1</span><span style="color:#24292e">),</span></span>
<span class="line"><span style="color:#24292e">        </span><span style="color:#032f62">"T3"</span><span style="color:#24292e">:  U[:, </span><span style="color:#005cc5">2</span><span style="color:#24292e">].reshape(</span><span style="color:#005cc5">3</span><span style="color:#24292e">, </span><span style="color:#005cc5">1</span><span style="color:#24292e">),</span></span>
<span class="line"><span style="color:#24292e">        </span><span style="color:#032f62">"T4"</span><span style="color:#24292e">: </span><span style="color:#d73a49">-</span><span style="color:#24292e">U[:, </span><span style="color:#005cc5">2</span><span style="color:#24292e">].reshape(</span><span style="color:#005cc5">3</span><span style="color:#24292e">, </span><span style="color:#005cc5">1</span><span style="color:#24292e">),</span></span>
<span class="line"><span style="color:#24292e">        </span><span style="color:#032f62">"R1"</span><span style="color:#24292e">:  U </span><span style="color:#d73a49">@</span><span style="color:#24292e"> W   </span><span style="color:#d73a49">@</span><span style="color:#24292e"> V,</span></span>
<span class="line"><span style="color:#24292e">        </span><span style="color:#032f62">"R2"</span><span style="color:#24292e">:  U </span><span style="color:#d73a49">@</span><span style="color:#24292e"> W   </span><span style="color:#d73a49">@</span><span style="color:#24292e"> V,</span></span>
<span class="line"><span style="color:#24292e">        </span><span style="color:#032f62">"R3"</span><span style="color:#24292e">:  U </span><span style="color:#d73a49">@</span><span style="color:#24292e"> W.T </span><span style="color:#d73a49">@</span><span style="color:#24292e"> V,</span></span>
<span class="line"><span style="color:#24292e">        </span><span style="color:#032f62">"R4"</span><span style="color:#24292e">:  U </span><span style="color:#d73a49">@</span><span style="color:#24292e"> W.T </span><span style="color:#d73a49">@</span><span style="color:#24292e"> V</span></span>
<span class="line"><span style="color:#24292e">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">for</span><span style="color:#24292e"> i </span><span style="color:#d73a49">in</span><span style="color:#24292e"> </span><span style="color:#005cc5">range</span><span style="color:#24292e">(</span><span style="color:#005cc5">1</span><span style="color:#24292e">, </span><span style="color:#005cc5">5</span><span style="color:#24292e">):</span></span>
<span class="line"><span style="color:#24292e">        T, R </span><span style="color:#d73a49">=</span><span style="color:#24292e"> poses[</span><span style="color:#032f62">"T"</span><span style="color:#24292e"> </span><span style="color:#d73a49">+</span><span style="color:#24292e"> </span><span style="color:#005cc5">str</span><span style="color:#24292e">(i)], poses[</span><span style="color:#032f62">"R"</span><span style="color:#24292e"> </span><span style="color:#d73a49">+</span><span style="color:#24292e"> </span><span style="color:#005cc5">str</span><span style="color:#24292e">(i)]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        </span><span style="color:#d73a49">if</span><span style="color:#24292e"> np.linalg.det(R) </span><span style="color:#d73a49">&lt;</span><span style="color:#24292e"> </span><span style="color:#005cc5">0</span><span style="color:#24292e">:</span></span>
<span class="line"><span style="color:#24292e">            T </span><span style="color:#d73a49">=</span><span style="color:#24292e"> </span><span style="color:#d73a49">-</span><span style="color:#24292e">T</span></span>
<span class="line"><span style="color:#24292e">            R </span><span style="color:#d73a49">=</span><span style="color:#24292e"> </span><span style="color:#d73a49">-</span><span style="color:#24292e">R</span></span>
<span class="line"><span style="color:#24292e">            poses[</span><span style="color:#032f62">"T"</span><span style="color:#24292e"> </span><span style="color:#d73a49">+</span><span style="color:#24292e"> </span><span style="color:#005cc5">str</span><span style="color:#24292e">(i)], poses[</span><span style="color:#032f62">"R"</span><span style="color:#24292e"> </span><span style="color:#d73a49">+</span><span style="color:#24292e"> </span><span style="color:#005cc5">str</span><span style="color:#24292e">(i)] </span><span style="color:#d73a49">=</span><span style="color:#24292e"> T, R</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        I </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.identity(</span><span style="color:#005cc5">3</span><span style="color:#24292e">)</span></span>
<span class="line"><span style="color:#24292e">        M </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.hstack((I, T.reshape(</span><span style="color:#005cc5">3</span><span style="color:#24292e">, </span><span style="color:#005cc5">1</span><span style="color:#24292e">)))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        poses[</span><span style="color:#032f62">"P"</span><span style="color:#24292e"> </span><span style="color:#d73a49">+</span><span style="color:#24292e"> </span><span style="color:#005cc5">str</span><span style="color:#24292e">(i)] </span><span style="color:#d73a49">=</span><span style="color:#24292e"> K </span><span style="color:#d73a49">@</span><span style="color:#24292e"> R </span><span style="color:#d73a49">@</span><span style="color:#24292e"> M</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    max_Z, rt_idx </span><span style="color:#d73a49">=</span><span style="color:#24292e"> </span><span style="color:#005cc5">0</span><span style="color:#24292e">, </span><span style="color:#005cc5">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">for</span><span style="color:#24292e"> i </span><span style="color:#d73a49">in</span><span style="color:#24292e"> </span><span style="color:#005cc5">range</span><span style="color:#24292e">(</span><span style="color:#005cc5">1</span><span style="color:#24292e">, </span><span style="color:#005cc5">5</span><span style="color:#24292e">):</span></span>
<span class="line"><span style="color:#24292e">        T1, R1 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> poses[</span><span style="color:#032f62">"T"</span><span style="color:#24292e"> </span><span style="color:#d73a49">+</span><span style="color:#24292e"> </span><span style="color:#005cc5">str</span><span style="color:#24292e">(i)], poses[</span><span style="color:#032f62">"R"</span><span style="color:#24292e"> </span><span style="color:#d73a49">+</span><span style="color:#24292e"> </span><span style="color:#005cc5">str</span><span style="color:#24292e">(i)]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        </span><span style="color:#6a737d"># ---------------------</span></span>
<span class="line"><span style="color:#24292e">        T2, R2 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.asarray([[</span><span style="color:#005cc5">0</span><span style="color:#24292e">],[</span><span style="color:#005cc5">0</span><span style="color:#24292e">],[</span><span style="color:#005cc5">0</span><span style="color:#24292e">]]), np.identity(</span><span style="color:#005cc5">3</span><span style="color:#24292e">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        X </span><span style="color:#d73a49">=</span><span style="color:#24292e"> linear_triangulation(T2, R2, T1, R1, pt1, pt2, K)</span></span>
<span class="line"><span style="color:#24292e">        Z </span><span style="color:#d73a49">=</span><span style="color:#24292e"> </span><span style="color:#005cc5">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        </span><span style="color:#d73a49">for</span><span style="color:#24292e"> j </span><span style="color:#d73a49">in</span><span style="color:#24292e"> </span><span style="color:#005cc5">range</span><span style="color:#24292e">(X.shape[</span><span style="color:#005cc5">0</span><span style="color:#24292e">]):</span></span>
<span class="line"><span style="color:#24292e">            x </span><span style="color:#d73a49">=</span><span style="color:#24292e"> X[j, :].reshape(</span><span style="color:#d73a49">-</span><span style="color:#005cc5">1</span><span style="color:#24292e">, </span><span style="color:#005cc5">1</span><span style="color:#24292e">)</span></span>
<span class="line"><span style="color:#24292e">            </span><span style="color:#d73a49">if</span><span style="color:#24292e"> R1[</span><span style="color:#005cc5">2</span><span style="color:#24292e">] </span><span style="color:#d73a49">@</span><span style="color:#24292e"> np.subtract(x[</span><span style="color:#005cc5">0</span><span style="color:#24292e">:</span><span style="color:#005cc5">3</span><span style="color:#24292e">], T1) </span><span style="color:#d73a49">&gt;</span><span style="color:#24292e"> </span><span style="color:#005cc5">0</span><span style="color:#24292e"> </span><span style="color:#d73a49">and</span><span style="color:#24292e"> x[</span><span style="color:#005cc5">2</span><span style="color:#24292e">] </span><span style="color:#d73a49">&gt;</span><span style="color:#24292e"> </span><span style="color:#005cc5">0</span><span style="color:#24292e">:</span></span>
<span class="line"><span style="color:#24292e">                Z </span><span style="color:#d73a49">+=</span><span style="color:#24292e"> </span><span style="color:#005cc5">1</span></span>
<span class="line"><span style="color:#24292e">        </span><span style="color:#6a737d"># ---------------------</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">        </span><span style="color:#d73a49">if</span><span style="color:#24292e"> max_Z </span><span style="color:#d73a49">&lt;</span><span style="color:#24292e"> Z:</span></span>
<span class="line"><span style="color:#24292e">            max_Z, rt_idx </span><span style="color:#d73a49">=</span><span style="color:#24292e"> Z, </span><span style="color:#005cc5">str</span><span style="color:#24292e">(i)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    cur_T, cur_R </span><span style="color:#d73a49">=</span><span style="color:#24292e"> poses[</span><span style="color:#032f62">"T"</span><span style="color:#24292e"> </span><span style="color:#d73a49">+</span><span style="color:#24292e"> rt_idx], poses[</span><span style="color:#032f62">"R"</span><span style="color:#24292e"> </span><span style="color:#d73a49">+</span><span style="color:#24292e"> rt_idx]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">if</span><span style="color:#24292e"> cur_T[</span><span style="color:#005cc5">2</span><span style="color:#24292e">] </span><span style="color:#d73a49">&lt;</span><span style="color:#24292e"> </span><span style="color:#005cc5">0</span><span style="color:#24292e">:</span></span>
<span class="line"><span style="color:#24292e">        cur_T </span><span style="color:#d73a49">=</span><span style="color:#24292e"> </span><span style="color:#d73a49">-</span><span style="color:#24292e">cur_T</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">    </span><span style="color:#d73a49">return</span><span style="color:#24292e"> cur_T, cur_R</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e">cur_T, cur_R </span><span style="color:#d73a49">=</span><span style="color:#24292e"> recover_pose(E, kp1, kp2, K)</span></span>
<span class="line"></span></code></pre></div><hr><p>Again, here is how to implement it in OpenCV:</p><div class="language-python"><span class="lang">python</span><pre class="shiki github-dark-dimmed shiki-dark"><code v-pre=""><span class="line"><span style="color:#adbac7">kp1 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.array([pt </span><span style="color:#f47067">for</span><span style="color:#adbac7"> (idx, pt) </span><span style="color:#f47067">in</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">enumerate</span><span style="color:#adbac7">(kp1) </span><span style="color:#f47067">if</span><span style="color:#adbac7"> mask[idx] </span><span style="color:#f47067">==</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">])</span></span>
<span class="line"><span style="color:#adbac7">kp2 </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.array([pt </span><span style="color:#f47067">for</span><span style="color:#adbac7"> (idx, pt) </span><span style="color:#f47067">in</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">enumerate</span><span style="color:#adbac7">(kp2) </span><span style="color:#f47067">if</span><span style="color:#adbac7"> mask[idx] </span><span style="color:#f47067">==</span><span style="color:#adbac7"> </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">])</span></span>
<span class="line"><span style="color:#adbac7">_, cur_R, cur_t, _ </span><span style="color:#f47067">=</span><span style="color:#adbac7"> cv2.recoverPose(E, kp2, kp1, K)</span></span>
<span class="line"></span></code></pre><pre class="shiki github-light shiki-light"><code v-pre=""><span class="line"><span style="color:#24292e">kp1 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.array([pt </span><span style="color:#d73a49">for</span><span style="color:#24292e"> (idx, pt) </span><span style="color:#d73a49">in</span><span style="color:#24292e"> </span><span style="color:#005cc5">enumerate</span><span style="color:#24292e">(kp1) </span><span style="color:#d73a49">if</span><span style="color:#24292e"> mask[idx] </span><span style="color:#d73a49">==</span><span style="color:#24292e"> </span><span style="color:#005cc5">1</span><span style="color:#24292e">])</span></span>
<span class="line"><span style="color:#24292e">kp2 </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.array([pt </span><span style="color:#d73a49">for</span><span style="color:#24292e"> (idx, pt) </span><span style="color:#d73a49">in</span><span style="color:#24292e"> </span><span style="color:#005cc5">enumerate</span><span style="color:#24292e">(kp2) </span><span style="color:#d73a49">if</span><span style="color:#24292e"> mask[idx] </span><span style="color:#d73a49">==</span><span style="color:#24292e"> </span><span style="color:#005cc5">1</span><span style="color:#24292e">])</span></span>
<span class="line"><span style="color:#24292e">_, cur_R, cur_t, _ </span><span style="color:#d73a49">=</span><span style="color:#24292e"> cv2.recoverPose(E, kp2, kp1, K)</span></span>
<span class="line"></span></code></pre></div><h2 id="trajectory" tabindex="-1">Trajectory <a class="header-anchor" href="#trajectory" aria-hidden="true">#</a></h2><p>Denote the pose of the camera as <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6151em"></span><span class="mord mathnormal">t</span></span></span></span>, which should be initialized as:</p><div class="language-python"><span class="lang">python</span><pre class="shiki github-dark-dimmed shiki-dark"><code v-pre=""><span class="line"><span style="color:#adbac7">R, T </span><span style="color:#f47067">=</span><span style="color:#adbac7"> np.identity(</span><span style="color:#6cb6ff">3</span><span style="color:#adbac7">), np.zeros((</span><span style="color:#6cb6ff">3</span><span style="color:#adbac7">, </span><span style="color:#6cb6ff">1</span><span style="color:#adbac7">))</span></span>
<span class="line"></span></code></pre><pre class="shiki github-light shiki-light"><code v-pre=""><span class="line"><span style="color:#24292e">R, T </span><span style="color:#d73a49">=</span><span style="color:#24292e"> np.identity(</span><span style="color:#005cc5">3</span><span style="color:#24292e">), np.zeros((</span><span style="color:#005cc5">3</span><span style="color:#24292e">, </span><span style="color:#005cc5">1</span><span style="color:#24292e">))</span></span>
<span class="line"></span></code></pre></div><p>We can update the trajectory of the camera by:</p><p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6151em"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6984em;vertical-align:-.0833em"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:.00773em">R</span></span></span></span></span></p><div class="language-python"><span class="lang">python</span><pre class="shiki github-dark-dimmed shiki-dark"><code v-pre=""><span class="line"><span style="color:#adbac7">T </span><span style="color:#f47067">=</span><span style="color:#adbac7"> T </span><span style="color:#f47067">+</span><span style="color:#adbac7"> R </span><span style="color:#f47067">@</span><span style="color:#adbac7"> cur_T</span></span>
<span class="line"><span style="color:#adbac7">R </span><span style="color:#f47067">=</span><span style="color:#adbac7"> cur_R </span><span style="color:#f47067">@</span><span style="color:#adbac7"> R</span></span>
<span class="line"></span></code></pre><pre class="shiki github-light shiki-light"><code v-pre=""><span class="line"><span style="color:#24292e">T </span><span style="color:#d73a49">=</span><span style="color:#24292e"> T </span><span style="color:#d73a49">+</span><span style="color:#24292e"> R </span><span style="color:#d73a49">@</span><span style="color:#24292e"> cur_T</span></span>
<span class="line"><span style="color:#24292e">R </span><span style="color:#d73a49">=</span><span style="color:#24292e"> cur_R </span><span style="color:#d73a49">@</span><span style="color:#24292e"> R</span></span>
<span class="line"></span></code></pre></div><p>That’s it! We can now move to the next pair of frames <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0785em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2083em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0785em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2083em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> and repeat from <a href="#feature-detection">here</a>.</p><p>Of course, there are many details and optimizations (e.g. bundle adjustment) that can be added to improve the accuracy and performance of the VO system, but this should give a good starting point for building a monocular VO system.</p><h2 id="references" tabindex="-1">References <a class="header-anchor" href="#references" aria-hidden="true">#</a></h2><ul><li><a href="https://cmsc426.github.io/sfm/" target="_blank" rel="noopener noreferrer">Structure from Motion (University of Maryland)</a></li><li><a href="https://www.cs.cmu.edu/~16385/s17/Slides/12.4_8Point_Algorithm.pdf" target="_blank" rel="noopener noreferrer">The 8-point algorithm (Carnegie Mellon University)</a></li><li><a href="https://www.crcv.ucf.edu/wp-content/uploads/2019/03/Lecture-13-FundamentalMatrix.pdf" target="_blank" rel="noopener noreferrer">Fundamental Matrix (University of Central Florida)</a></li><li><a href="https://www-users.cse.umn.edu/~hspark/CSci5980/nister.pdf" target="_blank" rel="noopener noreferrer">An Efficient Solution to the Five-Point Relative Pose Problem</a>. <em>David Nistér</em>. IEEE Transactions on Pattern Analysis and Machine Intelligence, 2004.</li><li><a href="https://avisingh599.github.io/vision/monocular-vo/" target="_blank" rel="noopener noreferrer">Monocular Visual Odometry using OpenCV</a></li></ul></div></article><div prose-lg="" mx-auto="" mt-16="" data-v-9b596018=""><div class="grid md:grid-cols-2 pb-3 text-[0.95em]" data-v-9b596018=""><a href="https://github.com/Renovamen/renovamen.github.io/edit/main/pages/posts/2022-12-19-monocular-visual-odometry.md" title="Edit link" target="_blank" rel="noopener noreferrer" class="hover:underline text-c-active" data-v-9b596018=""><span i-tabler:edit="" w-4.5="" h-4.5="" align-text-top="" data-v-9b596018=""></span> Edit this page on GitHub</a><span text="md:right c-light" data-v-9b596018=""><span i-ic:round-update="" w-4.5="" h-4.5="" data-v-9b596018=""></span> Last updated: 12/30/2022, 6:14:46 AM</span></div><div class="grid md:grid-cols-2 pt-3 text-[0.95em] border-t border-c" data-v-9b596018=""><span class="prev" data-v-9b596018=""><a href="/posts/2022-06-28-new-mac" class="" hover:underline="" data-v-9b596018="">What to install after getting a new Macbook</a></span><span class="next text-right" data-v-9b596018=""><a href="/posts/2022-12-29-natural-gradient-decent" class="" hover:underline="" data-v-9b596018="">Natural Gradient Decent</a></span></div><div class="giscus" mt-20="" data-v-9b596018=""></div></div><!--]--></div><footer font="ui" text="sm center c-lighter" m="t-20">© Xiaohan Zou 2023<br>A dragon lost in human world</footer></main></div><script>window.__INITIAL_STATE__='{"pinia":{}}'</script><link rel="stylesheet" href="/assets/index-335b24fd.css"><link rel="stylesheet" href="/assets/post-1d6a6dca.css"></body></html>