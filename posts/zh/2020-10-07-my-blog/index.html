<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" href="/favicon.png" type="image/png">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">

    <link rel="canonical" href="https://zxh.io/posts/zh/2020-10-07-my-blog/">
    <meta name="generator" content="Astro v2.5.5">
    <meta name="msapplication-TileColor" content="#ffffff">

    <title>关于博客的碎碎念 - Xiaohan Zou</title>

    <!-- General Meta Tags -->
    <meta name="title" content="关于博客的碎碎念 - Xiaohan Zou">
    <meta name="description" content="A dragon lost in human world.">
    <meta name="author" content="Xiaohan Zou">

    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="关于博客的碎碎念 - Xiaohan Zou">
    <meta property="og:description" content="A dragon lost in human world.">
    <meta property="og:url" content="https://zxh.io/posts/zh/2020-10-07-my-blog/">

    <!-- Twitter -->
    <meta property="twitter:title" content="关于博客的碎碎念 - Xiaohan Zou">
    <meta property="twitter:description" content="A dragon lost in human world.">
    <meta property="twitter:url" content="https://zxh.io/posts/zh/2020-10-07-my-blog/">

    
  <link rel="stylesheet" href="/_astro/404.d9c9200c.css" />
<link rel="stylesheet" href="/_astro/index.90e3680a.css" />
<link rel="stylesheet" href="/_astro/_slug_.8db38b5a.css" /><script type="module" src="/_astro/hoisted.aef143c1.js"></script></head>

  <body class="font-sans">
    <main class="post astro-GVPN4U4B flex flex-col min-h-full text-c px-4 pt-24 pb-4 md:pb-6">
      <style>astro-island,astro-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var l;{let c={0:t=>t,1:t=>JSON.parse(t,o),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(JSON.parse(t,o)),5:t=>new Set(JSON.parse(t,o)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(JSON.parse(t)),9:t=>new Uint16Array(JSON.parse(t)),10:t=>new Uint32Array(JSON.parse(t))},o=(t,s)=>{if(t===""||!Array.isArray(s))return s;let[e,n]=s;return e in c?c[e](n):void 0};customElements.get("astro-island")||customElements.define("astro-island",(l=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=()=>{if(!this.hydrator||this.parentElement&&this.parentElement.closest("astro-island[ssr]"))return;let s=this.querySelectorAll("astro-slot"),e={},n=this.querySelectorAll("template[data-astro-template]");for(let r of n){let i=r.closest(this.tagName);!i||!i.isSameNode(this)||(e[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of s){let i=r.closest(this.tagName);!i||!i.isSameNode(this)||(e[r.getAttribute("name")||"default"]=r.innerHTML)}let a=this.hasAttribute("props")?JSON.parse(this.getAttribute("props"),o):{};this.hydrator(this)(this.Component,a,e,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),window.removeEventListener("astro:hydrate",this.hydrate),window.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((s,e)=>{e.disconnect(),this.childrenConnectedCallback()}).observe(this,{childList:!0})}async childrenConnectedCallback(){window.addEventListener("astro:hydrate",this.hydrate);let s=this.getAttribute("before-hydration-url");s&&await import(s),this.start()}start(){let s=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(Astro[e]===void 0){window.addEventListener(`astro:${e}`,()=>this.start(),{once:!0});return}Astro[e](async()=>{let n=this.getAttribute("renderer-url"),[a,{default:r}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(let d of i.split("."))this.Component=this.Component[d]}return this.hydrator=r,this.hydrate},s,this)}attributeChangedCallback(){this.hydrator&&this.hydrate()}},l.observedAttributes=["props"],l))}})();</script><astro-island uid="ZQ6NSc" data-solid-render-id="s1" component-url="/_astro/Navbar.77a1f8e2.js" component-export="default" renderer-url="/_astro/client.6684d98a.js" props="{&quot;activePage&quot;:[0,&quot;posts&quot;],&quot;hasToc&quot;:[0,false]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;Navbar&quot;,&quot;value&quot;:true}" await-children=""><header data-hk="s10-0" class="z-30 w-full h-14 hstack justify-between bg-c font-ui px-4 md:px-5 false false absolute top-0 left-0"><a font-bold text="c-light hover:c-dark" href="/"><span text-lg>hi@zxh</span><div i-fa6-solid:angle-right class="prompt inline-block"></div><span class="blink">_</span></a><nav hstack space-x-4><a nav-item href="/projects" title="Projects"><div i-ph:rocket-launch-duotone class="md:hidden"></div><span class="lt-md:hidden false">Projects</span></a><a nav-item href="/posts" title="Blog"><div i-majesticons:pencil-line class="md:hidden"></div><span class="lt-md:hidden active">Blog</span></a><a nav-item href="/search" title="Search"><span i-uil:search></span></a><button nav-item title="Toggle dark"><div i="carbon-sun dark:carbon-moon"></div></button><!--#--><!--/--></nav></header></astro-island>
      <div class="flex-1 mb-6">
        <div class="prose prose-lg mx-auto">
          
  <div mt-6 mb-8 class="astro-GVPN4U4B">
    <h1 text-4xl font-bold leading-12 my-0 class="astro-GVPN4U4B">关于博客的碎碎念</h1>
    <p text-c-lighter mt-2 class="astro-GVPN4U4B">
      Oct 7, 2020 · 10 min
      <span class="astro-GVPN4U4B">
            ·
            <span i-uil:tag-alt text-sm class="astro-GVPN4U4B"></span>
            <span class="astro-GVPN4U4B">
                <a href="/posts/zh/tags/experience" class="!text-c astro-GVPN4U4B">
                  experience
                </a>
                
              </span>
          </span>
    </p>
  </div>

  <div class="content mb-16 astro-GVPN4U4B">
    
    <p>“虽然研究进度堪忧，但鱼还是要摸的”，在这样的理念的驱动下，菜鸡最终折腾出了一个目前看上去还算可以的方案。</p>
<p>我的博客最初 fork 自 <a href="https://github.com/Huxpro/huxpro.github.io" target="_blank" rel="noopener noreferrer">Huxpro/huxpro.github.io</a>，用了一段时间之后开始瞎改，把别人干净的代码改得乱七八糟。博客用的是 Jekyll 框架，而 Jekyll 就是 Github Pages 的默认引擎，所以在部署的时候 Github Pages 连 build 这一步都帮你省了。于是在很长一段时间内，作为一只懒惰的菜鸡，我并没有什么动力来折腾这些东西。而现在之所以要折腾，是因为不折腾的确不行了。</p>
<div class="custom-block warning"><p class="custom-block-title">WARNING</p><p>不过这版博客已经是用 <a href="https://astro.build/" target="_blank" rel="noopener noreferrer">Astro</a> 写的全新的版本了，所以这篇文章中的某些部分已经并不适用了…</p></div>
<h2 id="奇怪的起因"><a aria-hidden="true" tabindex="-1" class="header-anchor" href="#奇怪的起因">#</a>奇怪的起因</h2>
<p>说起来这还是一个漫长的故事。首先我的博客的公式渲染引擎用的是 <a href="https://katex.org/" target="_blank" rel="noopener noreferrer">Katex</a>，因为它快，比 Mathjax 快多了（可以参考<a href="https://katex.org/" target="_blank" rel="noopener noreferrer">这里</a>）。</p>
<p>kramdown 的默认数学公式渲染引擎是 Mathjax，而从 <code>v2.0.0</code> 开始 kramdown 似乎引入了一些插件来支持 Katex，比如 <a href="https://github.com/kramdown/math-katex" target="_blank" rel="noopener noreferrer">kramdown-math-katex</a>。那么问题来了，Github Pages 的 Jekyll 是不支持除了<a href="https://pages.github.com/versions/" target="_blank" rel="noopener noreferrer">这些插件</a>以外的插件的。那么唯一的办法就只有在本地 build 网站，然后把 build 好的文件 push 到 <code>gh-pages</code> 分支上去。</p>
<p>不行，这样多麻烦，Jekyll 的天生优势不就没了吗，不然我为啥不用 Hexo 或者 Hugo，它们还比 Jekyll 快，不行不行。</p>
<p>那个时候还没有 Github Actions 这种东西，我又完全不知道别的持续集成方案，就算知道了估计也不想去折腾。于是我在<a href="https://xuc.me/blog/katex-and-jekyll/" target="_blank" rel="noopener noreferrer">这里</a>看到了一个比较 hack 的方法，首先让 kramdown 以为我们要用 Mathjax：</p>
<p></p><div class="language-yaml"><span class="lang">yaml</span><p></p>
<div data-rehype-pretty-code-fragment=""><pre data-language="yaml" data-theme="light"><code data-language="yaml" data-theme="light"><span class="line"><span style="color: #22863A">markdown</span><span style="color: #24292E">: </span><span style="color: #032F62">kramdown</span></span>
<span class="line"><span style="color: #22863A">kramdown</span><span style="color: #24292E">:</span></span>
<span class="line highlighted"><span style="color: #24292E">  </span><span style="color: #22863A">math_engine</span><span style="color: #24292E">: </span><span style="color: #032F62">mathjax</span></span></code></pre><pre data-language="yaml" data-theme="dark"><code data-language="yaml" data-theme="dark"><span class="line"><span style="color: #85E89D">markdown</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">kramdown</span></span>
<span class="line"><span style="color: #85E89D">kramdown</span><span style="color: #E1E4E8">:</span></span>
<span class="line highlighted"><span style="color: #E1E4E8">  </span><span style="color: #85E89D">math_engine</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">mathjax</span></span></code></pre></div>
</div>
<p>这样 kramdown 就会把像 <code>$$a + b$$</code> 这样的公式转换成 Mathjax 能识别的 HTML 形式：</p>
<p></p><div class="language-js"><span class="lang">js</span><p></p>
<div data-rehype-pretty-code-fragment=""><pre data-language="js" data-theme="light"><code data-language="js" data-theme="light"><span class="line"><span style="color: #24292E">&#x3C;</span><span style="color: #22863A">script</span><span style="color: #24292E"> </span><span style="color: #6F42C1">type</span><span style="color: #D73A49">=</span><span style="color: #032F62">"math/tex"</span><span style="color: #24292E">>a + b&#x3C;/</span><span style="color: #22863A">script</span><span style="color: #24292E">></span></span></code></pre><pre data-language="js" data-theme="dark"><code data-language="js" data-theme="dark"><span class="line"><span style="color: #E1E4E8">&#x3C;</span><span style="color: #85E89D">script</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">type</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">"math/tex"</span><span style="color: #E1E4E8">>a + b&#x3C;/</span><span style="color: #85E89D">script</span><span style="color: #E1E4E8">></span></span></code></pre></div>
</div>
<p>然后通过 JavaScript 把 <code>&#x3C;script type="math/tex"></code> 标签里的东西用 Katex 渲染出来：</p>
<p></p><div class="language-js"><span class="lang">js</span><p></p>
<div data-rehype-pretty-code-fragment=""><pre data-language="js" data-theme="light"><code data-language="js" data-theme="light"><span class="line"><span style="color: #6F42C1">$</span><span style="color: #24292E">(</span><span style="color: #032F62">"script[type='math/tex']"</span><span style="color: #24292E">).</span><span style="color: #6F42C1">replaceWith</span><span style="color: #24292E">(</span><span style="color: #D73A49">function</span><span style="color: #24292E"> () {</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">var</span><span style="color: #24292E"> tex </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">$</span><span style="color: #24292E">(</span><span style="color: #005CC5">this</span><span style="color: #24292E">).</span><span style="color: #6F42C1">text</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> katex.</span><span style="color: #6F42C1">renderToString</span><span style="color: #24292E">(tex, {</span></span>
<span class="line"><span style="color: #24292E">    displayMode: </span><span style="color: #005CC5">false</span></span>
<span class="line"><span style="color: #24292E">  });</span></span>
<span class="line"><span style="color: #24292E">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6F42C1">$</span><span style="color: #24292E">(</span><span style="color: #032F62">"script[type='math/tex; mode=display']"</span><span style="color: #24292E">).</span><span style="color: #6F42C1">replaceWith</span><span style="color: #24292E">(</span><span style="color: #D73A49">function</span><span style="color: #24292E"> () {</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">var</span><span style="color: #24292E"> tex </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">$</span><span style="color: #24292E">(</span><span style="color: #005CC5">this</span><span style="color: #24292E">).</span><span style="color: #6F42C1">html</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> katex.</span><span style="color: #6F42C1">renderToString</span><span style="color: #24292E">(tex.</span><span style="color: #6F42C1">replace</span><span style="color: #24292E">(</span><span style="color: #032F62">/%</span><span style="color: #005CC5">.</span><span style="color: #D73A49">*</span><span style="color: #032F62">/</span><span style="color: #D73A49">g</span><span style="color: #24292E">, </span><span style="color: #032F62">""</span><span style="color: #24292E">), {</span></span>
<span class="line"><span style="color: #24292E">    displayMode: </span><span style="color: #005CC5">true</span></span>
<span class="line"><span style="color: #24292E">  });</span></span>
<span class="line"><span style="color: #24292E">});</span></span></code></pre><pre data-language="js" data-theme="dark"><code data-language="js" data-theme="dark"><span class="line"><span style="color: #B392F0">$</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">"script[type='math/tex']"</span><span style="color: #E1E4E8">).</span><span style="color: #B392F0">replaceWith</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">function</span><span style="color: #E1E4E8"> () {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> tex </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">$</span><span style="color: #E1E4E8">(</span><span style="color: #79B8FF">this</span><span style="color: #E1E4E8">).</span><span style="color: #B392F0">text</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> katex.</span><span style="color: #B392F0">renderToString</span><span style="color: #E1E4E8">(tex, {</span></span>
<span class="line"><span style="color: #E1E4E8">    displayMode: </span><span style="color: #79B8FF">false</span></span>
<span class="line"><span style="color: #E1E4E8">  });</span></span>
<span class="line"><span style="color: #E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #B392F0">$</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">"script[type='math/tex; mode=display']"</span><span style="color: #E1E4E8">).</span><span style="color: #B392F0">replaceWith</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">function</span><span style="color: #E1E4E8"> () {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> tex </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">$</span><span style="color: #E1E4E8">(</span><span style="color: #79B8FF">this</span><span style="color: #E1E4E8">).</span><span style="color: #B392F0">html</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> katex.</span><span style="color: #B392F0">renderToString</span><span style="color: #E1E4E8">(tex.</span><span style="color: #B392F0">replace</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">/</span><span style="color: #DBEDFF">%</span><span style="color: #79B8FF">.</span><span style="color: #F97583">*</span><span style="color: #9ECBFF">/</span><span style="color: #F97583">g</span><span style="color: #E1E4E8">, </span><span style="color: #9ECBFF">""</span><span style="color: #E1E4E8">), {</span></span>
<span class="line"><span style="color: #E1E4E8">    displayMode: </span><span style="color: #79B8FF">true</span></span>
<span class="line"><span style="color: #E1E4E8">  });</span></span>
<span class="line"><span style="color: #E1E4E8">});</span></span></code></pre></div>
</div>
<p>虽然看上去不太优雅，但好歹能用，本菜鸡的理念是能用就行，于是就这样过了一段时间。直到几个月前，我发现我博客的公式不对劲了，它们突然都变成了这样：<code>\(a + b\)</code>。</p>
<p>我一脸懵逼，第一反应是我是不是又把博客哪儿的代码搞崩了，但想了想我似乎也没有动过公式那部分的代码？而且当时我部署在 Coding Pages 上的博客公式还是正常的，那么大概率就是 Github Pages 哪里不对劲了。</p>
<p>搜了一下发现 Github Pages 把 kramdown 的版本更新到了 <code>v2.2.0</code>，从这一版开始，为了兼容 Mathjax <code>v3.x</code>，kramdown 会把 inline math 转换成 <code>\(a + b\)</code> 的形式，把 block math 转换成 <code>\[a + b\]</code> 的形式（参考<a href="https://github.com/gettalong/kramdown/commit/c3acf8df1db49d2456050f4456f3f542294e2e8f" target="_blank" rel="noopener noreferrer">这个 commit</a>），于是上面那段脚本就坏掉了。</p>
<p>于是一切都回到了最初的起点，摆在面前的办法只剩下把在本地用 kramdown <code>v2.1.0</code> build 好的网站扔 <code>gh-pages</code> 上去。这样干了几个月后懒惰的我实在忍不了了，并决定让 Github Actions 来帮我干这件事。</p>
<p>所以我当初为啥不选 Hexo…</p>
<h2 id="github-actions"><a aria-hidden="true" tabindex="-1" class="header-anchor" href="#github-actions">#</a>Github Actions</h2>
<p>在 repo 下建一个目录 <code>.github/workflow</code>，在这个目录下放一个 <code>.yaml</code> 格式的 workflow 文件。GitHub 只要发现 <code>.github/workflows</code> 下有 <code>.yaml</code> 文件，就会自动运行它们。<a href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions" target="_blank" rel="noopener noreferrer">这里</a>是 workflow 文件的详细文档。</p>
<h3 id="jekyll"><a aria-hidden="true" tabindex="-1" class="header-anchor" href="#jekyll">#</a>Jekyll</h3>
<p><a href="https://jekyllrb.com/docs/continuous-integration/github-actions/" target="_blank" rel="noopener noreferrer">Jekyll 官方</a>已经给了一个现成的 <a href="https://github.com/helaili/jekyll-action" target="_blank" rel="noopener noreferrer">action</a>，直接引用它就好：</p>
<p></p><div class="language-yaml"><span class="lang">yaml</span><p></p>
<div data-rehype-pretty-code-fragment=""><pre data-language="yaml" data-theme="light"><code data-language="yaml" data-theme="light"><span class="line"><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">build Jekyll site and deploy it to GitHub Pages</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 检测 master 分支上的推送和 pr</span></span>
<span class="line"><span style="color: #005CC5">on</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #22863A">push</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #22863A">branches</span><span style="color: #24292E">: [</span><span style="color: #032F62">master</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #22863A">pull_request</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #22863A">branches</span><span style="color: #24292E">: [</span><span style="color: #032F62">master</span><span style="color: #24292E">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #22863A">jobs</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #22863A">jekyll-build-and-deploy</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #22863A">runs-on</span><span style="color: #24292E">: </span><span style="color: #032F62">ubuntu-latest</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #22863A">steps</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">      - </span><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">checkout</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">uses</span><span style="color: #24292E">: </span><span style="color: #032F62">actions/checkout@v2</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># 检测 vendor/bundle 下有没有已经安装好的包</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># 如果有的话就不用再 bundle install 了，节省时间和资源</span></span>
<span class="line"><span style="color: #24292E">      - </span><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">check cache</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">uses</span><span style="color: #24292E">: </span><span style="color: #032F62">actions/cache@v1</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">with</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">path</span><span style="color: #24292E">: </span><span style="color: #032F62">vendor/bundle</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">key</span><span style="color: #24292E">: </span><span style="color: #032F62">runner.os−gems−{%raw%}{{ hashFiles('**/Gemfile.lock') }}{% endraw %}</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">restore-keys</span><span style="color: #24292E">: </span><span style="color: #D73A49">|</span></span>
<span class="line"><span style="color: #032F62">            ${{ runner.os }}-gems-</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># 引用 helaili/jekyll-action 来打包 Jekyll 网站</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># 并把打包好的文件推到同一个 repo 的 gh-pages 分支</span></span>
<span class="line"><span style="color: #24292E">      - </span><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">build and deploy</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">uses</span><span style="color: #24292E">: </span><span style="color: #032F62">helaili/jekyll-action@2.0.4</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">env</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">JEKYLL_PAT</span><span style="color: #24292E">: </span><span style="color: #032F62">${{ secrets.GITHUB_TOKEN }}</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">with</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">target_branch</span><span style="color: #24292E">: </span><span style="color: #032F62">"gh-pages"</span></span></code></pre><pre data-language="yaml" data-theme="dark"><code data-language="yaml" data-theme="dark"><span class="line"><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">build Jekyll site and deploy it to GitHub Pages</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 检测 master 分支上的推送和 pr</span></span>
<span class="line"><span style="color: #79B8FF">on</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #85E89D">push</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #85E89D">branches</span><span style="color: #E1E4E8">: [</span><span style="color: #9ECBFF">master</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #85E89D">pull_request</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #85E89D">branches</span><span style="color: #E1E4E8">: [</span><span style="color: #9ECBFF">master</span><span style="color: #E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #85E89D">jobs</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #85E89D">jekyll-build-and-deploy</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #85E89D">runs-on</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">ubuntu-latest</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #85E89D">steps</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">      - </span><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">checkout</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">uses</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">actions/checkout@v2</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># 检测 vendor/bundle 下有没有已经安装好的包</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># 如果有的话就不用再 bundle install 了，节省时间和资源</span></span>
<span class="line"><span style="color: #E1E4E8">      - </span><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">check cache</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">uses</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">actions/cache@v1</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">with</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">path</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">vendor/bundle</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">key</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">runner.os−gems−{%raw%}{{ hashFiles('**/Gemfile.lock') }}{% endraw %}</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">restore-keys</span><span style="color: #E1E4E8">: </span><span style="color: #F97583">|</span></span>
<span class="line"><span style="color: #9ECBFF">            ${{ runner.os }}-gems-</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># 引用 helaili/jekyll-action 来打包 Jekyll 网站</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># 并把打包好的文件推到同一个 repo 的 gh-pages 分支</span></span>
<span class="line"><span style="color: #E1E4E8">      - </span><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">build and deploy</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">uses</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">helaili/jekyll-action@2.0.4</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">env</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">JEKYLL_PAT</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">${{ secrets.GITHUB_TOKEN }}</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">with</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">target_branch</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"gh-pages"</span></span></code></pre></div>
</div>
<p>相当于这个 workflow 会自动检测 <code>master</code> 分支上的 push 和 pull_request，一旦检测就到准备环境，然后运行 <code>bundle exec jekyll build</code> 打包网站，并把打包产物扔 <code>gh-pages</code> 分支上去。</p>
<p>需要注意的是必须得有一个 <code>Gemfile</code> 和 <code>Gemfile.lock</code> 文件，<code>Gemfile</code> 里面写上要装的包，比如本博客的 <code>Gemfile</code> 长这样：</p>
<p></p><div class="language-ruby"><span class="lang">ruby</span><p></p>
<div data-rehype-pretty-code-fragment=""><pre data-language="ruby" data-theme="light"><code data-language="ruby" data-theme="light"><span class="line"><span style="color: #24292E">source </span><span style="color: #032F62">'https://rubygems.org'</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">gem </span><span style="color: #032F62">'jekyll'</span><span style="color: #24292E">, </span><span style="color: #032F62">'~> 4.0'</span></span>
<span class="line"><span style="color: #24292E">gem </span><span style="color: #032F62">'kramdown'</span><span style="color: #24292E">, </span><span style="color: #032F62">'= 2.1.0'</span><span style="color: #24292E">  </span><span style="color: #6A737D"># 这里为了 Katex 把 kramdown 版本固定在了 2.1.0</span></span>
<span class="line"><span style="color: #24292E">gem </span><span style="color: #032F62">'jemoji'</span><span style="color: #24292E">, </span><span style="color: #032F62">'~> 0.11.1'</span></span>
<span class="line"><span style="color: #24292E">gem </span><span style="color: #032F62">'jekyll-paginate'</span><span style="color: #24292E">, </span><span style="color: #032F62">'~> 1.1.0'</span></span></code></pre><pre data-language="ruby" data-theme="dark"><code data-language="ruby" data-theme="dark"><span class="line"><span style="color: #E1E4E8">source </span><span style="color: #9ECBFF">'https://rubygems.org'</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">gem </span><span style="color: #9ECBFF">'jekyll'</span><span style="color: #E1E4E8">, </span><span style="color: #9ECBFF">'~> 4.0'</span></span>
<span class="line"><span style="color: #E1E4E8">gem </span><span style="color: #9ECBFF">'kramdown'</span><span style="color: #E1E4E8">, </span><span style="color: #9ECBFF">'= 2.1.0'</span><span style="color: #E1E4E8">  </span><span style="color: #6A737D"># 这里为了 Katex 把 kramdown 版本固定在了 2.1.0</span></span>
<span class="line"><span style="color: #E1E4E8">gem </span><span style="color: #9ECBFF">'jemoji'</span><span style="color: #E1E4E8">, </span><span style="color: #9ECBFF">'~> 0.11.1'</span></span>
<span class="line"><span style="color: #E1E4E8">gem </span><span style="color: #9ECBFF">'jekyll-paginate'</span><span style="color: #E1E4E8">, </span><span style="color: #9ECBFF">'~> 1.1.0'</span></span></code></pre></div>
</div>
<p>如果用了自定义域名，那就还需要在 <code>master</code> 分支放一个 <code>CNAME</code>，这样 <a href="https://github.com/helaili/jekyll-action" target="_blank" rel="noopener noreferrer">helaili/jekyll-action</a> 就会把 <code>CNAME</code> 也推到 <code>gh-pages</code> 分支去。直接在 <code>gh-pages</code> 分支加 <code>CNAME</code> 是没有什么用的，因为下次自动推送时它就会被清掉…</p>
<h3 id="nodejs"><a aria-hidden="true" tabindex="-1" class="header-anchor" href="#nodejs">#</a>Node.js</h3>
<p>所有能用 Node.js 搞定的东西（比如这个基于 VuePress 的博客）都能用以下工作流处理：</p>
<h4 id="npm"><a aria-hidden="true" tabindex="-1" class="header-anchor" href="#npm">#</a>npm</h4>
<p></p><div class="language-yaml"><span class="lang">yaml</span><p></p>
<div data-rehype-pretty-code-fragment=""><pre data-language="yaml" data-theme="light"><code data-language="yaml" data-theme="light"><span class="line"><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">build and deploy</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 检测 master 分支上的推送和 pr</span></span>
<span class="line"><span style="color: #005CC5">on</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #22863A">push</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #22863A">branches</span><span style="color: #24292E">: [</span><span style="color: #032F62">master</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #22863A">pull_request</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #22863A">branches</span><span style="color: #24292E">: [</span><span style="color: #032F62">master</span><span style="color: #24292E">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #22863A">jobs</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #22863A">build-and-deploy-vuepress</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #22863A">runs-on</span><span style="color: #24292E">: </span><span style="color: #032F62">ubuntu-latest</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #22863A">steps</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">      - </span><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">Checkout</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">uses</span><span style="color: #24292E">: </span><span style="color: #032F62">actions/checkout@v2</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># Node.js 环境</span></span>
<span class="line"><span style="color: #24292E">      - </span><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">Setup Node</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">uses</span><span style="color: #24292E">: </span><span style="color: #032F62">actions/setup-node@v2.1.2</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">with</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">node-version</span><span style="color: #24292E">: </span><span style="color: #032F62">"12.x"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">      - </span><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">Cache dependencies</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">uses</span><span style="color: #24292E">: </span><span style="color: #032F62">actions/cache@v2</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">with</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">path</span><span style="color: #24292E">: </span><span style="color: #032F62">~/.npm</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">key</span><span style="color: #24292E">: </span><span style="color: #032F62">${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">restore-keys</span><span style="color: #24292E">: </span><span style="color: #D73A49">|</span></span>
<span class="line"><span style="color: #032F62">            ${{ runner.os }}-node-</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># npm run build</span></span>
<span class="line"><span style="color: #24292E">      - </span><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">Build</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">run</span><span style="color: #24292E">: </span><span style="color: #D73A49">|</span></span>
<span class="line"><span style="color: #032F62">          npm ci</span></span>
<span class="line"><span style="color: #032F62">          npm run build</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># 推送到同一个 repo 的 gh-pages 分支</span></span>
<span class="line"><span style="color: #24292E">      - </span><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">Deploy</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">uses</span><span style="color: #24292E">: </span><span style="color: #032F62">peaceiris/actions-gh-pages@v3</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">with</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">github_token</span><span style="color: #24292E">: </span><span style="color: #032F62">${{ secrets.GITHUB_TOKEN }}</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">publish_dir</span><span style="color: #24292E">: </span><span style="color: #032F62">dist</span><span style="color: #24292E"> </span><span style="color: #6A737D"># build 输出文件夹</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">cname</span><span style="color: #24292E">: </span><span style="color: #032F62">zxh.io</span><span style="color: #24292E"> </span><span style="color: #6A737D"># 如果用了自定义域名，在这里设置</span></span></code></pre><pre data-language="yaml" data-theme="dark"><code data-language="yaml" data-theme="dark"><span class="line"><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">build and deploy</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># 检测 master 分支上的推送和 pr</span></span>
<span class="line"><span style="color: #79B8FF">on</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #85E89D">push</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #85E89D">branches</span><span style="color: #E1E4E8">: [</span><span style="color: #9ECBFF">master</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #85E89D">pull_request</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #85E89D">branches</span><span style="color: #E1E4E8">: [</span><span style="color: #9ECBFF">master</span><span style="color: #E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #85E89D">jobs</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #85E89D">build-and-deploy-vuepress</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #85E89D">runs-on</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">ubuntu-latest</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #85E89D">steps</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">      - </span><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">Checkout</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">uses</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">actions/checkout@v2</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># Node.js 环境</span></span>
<span class="line"><span style="color: #E1E4E8">      - </span><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">Setup Node</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">uses</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">actions/setup-node@v2.1.2</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">with</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">node-version</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"12.x"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">      - </span><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">Cache dependencies</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">uses</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">actions/cache@v2</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">with</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">path</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">~/.npm</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">key</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">restore-keys</span><span style="color: #E1E4E8">: </span><span style="color: #F97583">|</span></span>
<span class="line"><span style="color: #9ECBFF">            ${{ runner.os }}-node-</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># npm run build</span></span>
<span class="line"><span style="color: #E1E4E8">      - </span><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">Build</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">run</span><span style="color: #E1E4E8">: </span><span style="color: #F97583">|</span></span>
<span class="line"><span style="color: #9ECBFF">          npm ci</span></span>
<span class="line"><span style="color: #9ECBFF">          npm run build</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># 推送到同一个 repo 的 gh-pages 分支</span></span>
<span class="line"><span style="color: #E1E4E8">      - </span><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">Deploy</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">uses</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">peaceiris/actions-gh-pages@v3</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">with</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">github_token</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">${{ secrets.GITHUB_TOKEN }}</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">publish_dir</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">dist</span><span style="color: #E1E4E8"> </span><span style="color: #6A737D"># build 输出文件夹</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">cname</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">zxh.io</span><span style="color: #E1E4E8"> </span><span style="color: #6A737D"># 如果用了自定义域名，在这里设置</span></span></code></pre></div>
</div>
<p>其中 <a href="https://github.com/peaceiris/actions-gh-pages" target="_blank" rel="noopener noreferrer">peaceiris/actions-gh-pages</a> 也是一个别人写好的 action，能把指定路径的文件推到 <code>gh-pages</code> 分支。</p>
<h4 id="yarn"><a aria-hidden="true" tabindex="-1" class="header-anchor" href="#yarn">#</a>yarn</h4>
<p>如果包管理工具用的 <code>yarn</code>：</p>
<p></p><div class="language-yaml"><span class="lang">yaml</span><p></p>
<div data-rehype-pretty-code-fragment=""><pre data-language="yaml" data-theme="light"><code data-language="yaml" data-theme="light"><span class="line"><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">build and deploy</span></span>
<span class="line"></span>
<span class="line"><span style="color: #005CC5">on</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #22863A">push</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #22863A">branches</span><span style="color: #24292E">: [</span><span style="color: #032F62">master</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #22863A">pull_request</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #22863A">branches</span><span style="color: #24292E">: [</span><span style="color: #032F62">master</span><span style="color: #24292E">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #22863A">jobs</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #22863A">build-and-deploy-vuepress</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #22863A">runs-on</span><span style="color: #24292E">: </span><span style="color: #032F62">ubuntu-latest</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #22863A">steps</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">      - </span><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">Checkout</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">uses</span><span style="color: #24292E">: </span><span style="color: #032F62">actions/checkout@v2</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">      - </span><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">Setup Node</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">uses</span><span style="color: #24292E">: </span><span style="color: #032F62">actions/setup-node@v2.1.2</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">with</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">node-version</span><span style="color: #24292E">: </span><span style="color: #032F62">"12"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">      - </span><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">Get yarn cache</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">id</span><span style="color: #24292E">: </span><span style="color: #032F62">yarn-cache</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">run</span><span style="color: #24292E">: </span><span style="color: #032F62">echo "::set-output name=dir::$(yarn cache dir)"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">      - </span><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">Cache dependencies</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">uses</span><span style="color: #24292E">: </span><span style="color: #032F62">actions/cache@v2</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">with</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">path</span><span style="color: #24292E">: </span><span style="color: #032F62">${{ steps.yarn-cache.outputs.dir }}</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">key</span><span style="color: #24292E">: </span><span style="color: #032F62">${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">restore-keys</span><span style="color: #24292E">: </span><span style="color: #D73A49">|</span></span>
<span class="line"><span style="color: #032F62">            ${{ runner.os }}-yarn-</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">      - </span><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">Build</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">run</span><span style="color: #24292E">: </span><span style="color: #D73A49">|</span></span>
<span class="line"><span style="color: #032F62">          yarn install --frozen-lockfile</span></span>
<span class="line"><span style="color: #032F62">          yarn build</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">      - </span><span style="color: #22863A">name</span><span style="color: #24292E">: </span><span style="color: #032F62">Deploy</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">uses</span><span style="color: #24292E">: </span><span style="color: #032F62">peaceiris/actions-gh-pages@v3</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #22863A">with</span><span style="color: #24292E">:</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">github_token</span><span style="color: #24292E">: </span><span style="color: #032F62">${{ secrets.GITHUB_TOKEN }}</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">publish_dir</span><span style="color: #24292E">: </span><span style="color: #032F62">dist</span></span>
<span class="line"><span style="color: #24292E">          </span><span style="color: #22863A">cname</span><span style="color: #24292E">: </span><span style="color: #032F62">zxh.io</span></span></code></pre><pre data-language="yaml" data-theme="dark"><code data-language="yaml" data-theme="dark"><span class="line"><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">build and deploy</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79B8FF">on</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #85E89D">push</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #85E89D">branches</span><span style="color: #E1E4E8">: [</span><span style="color: #9ECBFF">master</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #85E89D">pull_request</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #85E89D">branches</span><span style="color: #E1E4E8">: [</span><span style="color: #9ECBFF">master</span><span style="color: #E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #85E89D">jobs</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #85E89D">build-and-deploy-vuepress</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #85E89D">runs-on</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">ubuntu-latest</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #85E89D">steps</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">      - </span><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">Checkout</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">uses</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">actions/checkout@v2</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">      - </span><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">Setup Node</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">uses</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">actions/setup-node@v2.1.2</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">with</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">node-version</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"12"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">      - </span><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">Get yarn cache</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">id</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">yarn-cache</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">run</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">echo "::set-output name=dir::$(yarn cache dir)"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">      - </span><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">Cache dependencies</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">uses</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">actions/cache@v2</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">with</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">path</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">${{ steps.yarn-cache.outputs.dir }}</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">key</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">restore-keys</span><span style="color: #E1E4E8">: </span><span style="color: #F97583">|</span></span>
<span class="line"><span style="color: #9ECBFF">            ${{ runner.os }}-yarn-</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">      - </span><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">Build</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">run</span><span style="color: #E1E4E8">: </span><span style="color: #F97583">|</span></span>
<span class="line"><span style="color: #9ECBFF">          yarn install --frozen-lockfile</span></span>
<span class="line"><span style="color: #9ECBFF">          yarn build</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">      - </span><span style="color: #85E89D">name</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">Deploy</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">uses</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">peaceiris/actions-gh-pages@v3</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #85E89D">with</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">github_token</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">${{ secrets.GITHUB_TOKEN }}</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">publish_dir</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">dist</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #85E89D">cname</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">zxh.io</span></span></code></pre></div>
</div>
<h2 id="优化"><a aria-hidden="true" tabindex="-1" class="header-anchor" href="#优化">#</a>优化</h2>
<h3 id="减少依赖"><a aria-hidden="true" tabindex="-1" class="header-anchor" href="#减少依赖">#</a>减少依赖</h3>
<p>通过砍掉一些觉得用不太上的功能，和直接手写一些比较简单的功能，去掉了一些依赖。但我已经忘了去掉了哪些了…</p>
<h3 id="合并依赖"><a aria-hidden="true" tabindex="-1" class="header-anchor" href="#合并依赖">#</a>合并依赖</h3>
<p>为了减少请求次数，可以尽量把多个 JS 或 CSS 文件合并压缩成一个。上 Gulp 之类的工具当然也可以，不过 jsDelivr 自带了合并功能，比如要合并以下两个库：</p>
<ul>
<li><a href="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js</a></li>
<li><a href="https://cdn.jsdelivr.net/npm/mermaid@8.4.8/dist/mermaid.min.js" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/npm/mermaid@8.4.8/dist/mermaid.min.js</a></li>
</ul>
<p>只需要：</p>
<p></p><div class="language-"><span class="lang"></span><p></p>
<pre><code>https://cdn.jsdelivr.net/combine/npm/chart.js@2.9.3/dist/Chart.min.js,npm/mermaid@8.4.8/dist/mermaid.min.js
</code></pre>
</div>
<p>于是我把除了 Katex 和 Mathjax（因为这俩涉及到引用字体的问题）以外的文件都合并成了一个 <code>lib.min.js</code>。</p>
<h3 id="cdn"><a aria-hidden="true" tabindex="-1" class="header-anchor" href="#cdn">#</a>CDN</h3>
<p>又一次喜闻乐见的白嫖 jsDelivr，对于托管在 Github 上的博客来说，在静态资源路径前加上以下 URL 即可：</p>
<p></p><div class="language-"><span class="lang"></span><p></p>
<pre><code>https://cdn.jsdelivr.net/gh/{{ 用户名 }}/{{ 仓库名 }}@{{ 分支名 }}
</code></pre>
</div>
<p>比如：</p>
<p></p><div class="language-"><span class="lang"></span><p></p>
<pre><code>https://cdn.jsdelivr.net/gh/Renovamen/renovamen.github.io@master/js/lib.min.js
</code></pre>
</div>
<h2 id="vercel"><a aria-hidden="true" tabindex="-1" class="header-anchor" href="#vercel">#</a>Vercel</h2>
<p>我一直以来都在听说双线部署甚至多线部署这种提高访问速度的操作，但一直没有去折腾。因为 Github Pages 虽然境内访问慢了点，但至少还是能访问的，那么能用就行了。直到几个月前，我发现 Github Pages 境内完全访问不上了…</p>
<p>间歇性抽风想想还是很让人不安，那行吧行吧双线部署我来了…</p>
<p>那时候我所知的有境内节点的静态网站托管服务就 <a href="https://gitee.com/help/articles/4136" target="_blank" rel="noopener noreferrer">Gitee Pages</a> 和 <a href="https://help.coding.net/docs/devops/cd/static-website.html" target="_blank" rel="noopener noreferrer">Coding Pages</a> 俩，而 Gitee Pages 不能免费自定义域名，于是就把境内的线路解析到了 Coding Pages 上。</p>
<p>然而不久之前，新版 Coding Pages 的静态网站合并到腾讯云静态网站，并开始收费了。之前旧版的静态网站还能正常部署和访问，但之后的网站就都得用新版。收费倒是并不贵且也没有什么问题，问题在于如果域名不备案的话，即使是境内的访问，Coding 也会强制给你上境外 CDN 加速，于是速度会很慢，估计比直接访问 Github Pages 还慢。</p>
<p>于是就手忙脚乱的把境内线路的博客扔到了 Vercel 上。只能说 Vercel 至少到目前为止还没发现什么毛病，有境内节点（不过感觉还是没有以前的 Coding Pages 快？），而且是直接自动从 Github 仓库上拉代码然后打包加部署，对菜鸡相当友好。</p>
<p>以前为啥就没发现呢。</p>
  </div>

  <div class="grid md:grid-cols-2 text-[0.95em] astro-GVPN4U4B">
    <a href="https://github.com/Renovamen/renovamen.github.io/edit/main/src/content/blog/zh/2020-10-07-my-blog.md" title="Edit link" target="_blank" rel="noopener noreferrer" class="hover:underline astro-GVPN4U4B">
      <span class="i-tabler:edit w-4.5 h-4.5 align-text-top astro-GVPN4U4B"></span>
      Edit this page on GitHub
    </a>
    <span md:text-right text-c-light class="astro-GVPN4U4B">
          <span class="i-ic:round-update w-4.5 h-4.5 astro-GVPN4U4B"></span>
          Last updated:
          6/19/2023, 8:53:28 AM
        </span>
  </div>

  <div class="mt-3 pt-3 text-[0.95em] astro-GVPN4U4B" grid="~ md:cols-2" border="t c">
        <span class="prev astro-GVPN4U4B">
          <a href="/posts/zh/2020-08-24-regularization-based-continual-learning" class="!text-c astro-GVPN4U4B">
              Regularization-based Continual Learning
            </a>
        </span>
        <span class="next text-right astro-GVPN4U4B">
          <a href="/posts/zh/2021-01-01-new-year" class="!text-c astro-GVPN4U4B">
              2021 新年快乐
            </a>
        </span>
      </div><div mt-20 class="astro-GVPN4U4B">
    <script>(()=>{var r=(s,c,i)=>{let o=async()=>{await(await s())()},n=new IntersectionObserver(e=>{for(let t of e)if(t.isIntersecting){n.disconnect(),o();break}});for(let e=0;e<i.children.length;e++){let t=i.children[e];n.observe(t)}};(self.Astro||(self.Astro={})).visible=r;window.dispatchEvent(new Event("astro:visible"));})();</script><astro-island uid="ZouB9q" data-solid-render-id="s0" component-url="/_astro/Giscus.fe86f833.js" component-export="default" renderer-url="/_astro/client.6684d98a.js" props="{&quot;class&quot;:[0,&quot;astro-GVPN4U4B&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;Giscus&quot;,&quot;value&quot;:true}" await-children=""><div data-hk="s00-0" class="giscus"></div></astro-island>
  </div>

        </div>
      </div>
      <footer class="max-w-content w-full hstack justify-between font-ui mx-auto mt-20 astro-SZ7XMLTE" text="xs lg:sm">
  <span text-c-lighter class="astro-SZ7XMLTE">
    <span class="astro-SZ7XMLTE">© Xiaohan Zou 2023</span>
    <span lt-sm:hidden class="astro-SZ7XMLTE">· A dragon lost in human world</span>
  </span>
  <span hstack space-x-3 class="astro-SZ7XMLTE">
    <a class="footer-item astro-SZ7XMLTE" href="https://github.com/Renovamen/renovamen.github.io" title="Source code" target="_blank" rel="noopener noreferrer">
      <div i-lucide:code-2 class="astro-SZ7XMLTE"></div>
      <span lt-sm:hidden class="astro-SZ7XMLTE">Code</span>
    </a>
    <a class="footer-item astro-SZ7XMLTE" href="/rss.xml" title="RSS" target="_blank" rel="noopener noreferrer">
      <div i-heroicons:rss-20-solid class="astro-SZ7XMLTE"></div>
      <span lt-sm:hidden class="astro-SZ7XMLTE">RSS</span>
    </a>
    <a class="footer-item astro-SZ7XMLTE" href="/sitemap-index.xml" title="Sitemap" target="_blank" rel="noopener noreferrer">
      <div i-bx:map-alt class="astro-SZ7XMLTE"></div>
      <span lt-sm:hidden class="astro-SZ7XMLTE">Sitemap</span>
    </a>
  </span>
</footer>
    </main>
  </body></html>

